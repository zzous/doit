{"remainingRequest":"/Users/zzou/Downloads/backup_sample/node_modules/thread-loader/dist/cjs.js!/Users/zzou/Downloads/backup_sample/node_modules/babel-loader/lib/index.js!/Users/zzou/Downloads/backup_sample/node_modules/bootstrap-vue/esm/components/tooltip/helpers/bv-tooltip.js","dependencies":[{"path":"/Users/zzou/Downloads/backup_sample/node_modules/bootstrap-vue/esm/components/tooltip/helpers/bv-tooltip.js","mtime":1610263603568},{"path":"/Users/zzou/Downloads/backup_sample/node_modules/cache-loader/dist/cjs.js","mtime":1582363961748},{"path":"/Users/zzou/Downloads/backup_sample/node_modules/thread-loader/dist/cjs.js","mtime":1582363962038},{"path":"/Users/zzou/Downloads/backup_sample/node_modules/babel-loader/lib/index.js","mtime":1585275399303}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29ydCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLmJpbmQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXByb3BlcnRpZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXByb3BlcnR5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3JzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5yZXBsYWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLnRpbWVycyI7CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOwogICAgfSBlbHNlIHsKICAgICAgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0gLy8gVG9vbHRpcCAiQ2xhc3MiIChCdWlsdCBhcyBhIHJlbmRlcmxlc3MgVnVlIGluc3RhbmNlKQovLwovLyBIYW5kbGVzIHRyaWdnZXIgZXZlbnRzLCBldGMuCi8vIEluc3RhbnRpYXRlcyB0ZW1wbGF0ZSBvbiBkZW1hbmQKCgppbXBvcnQgeyBDT01QT05FTlRfVUlEX0tFWSwgVnVlIH0gZnJvbSAnLi4vLi4vLi4vdnVlJzsKaW1wb3J0IHsgTkFNRV9NT0RBTCwgTkFNRV9UT09MVElQX0hFTFBFUiB9IGZyb20gJy4uLy4uLy4uL2NvbnN0YW50cy9jb21wb25lbnRzJzsKaW1wb3J0IHsgRVZFTlRfTkFNRV9ESVNBQkxFLCBFVkVOVF9OQU1FX0RJU0FCTEVELCBFVkVOVF9OQU1FX0VOQUJMRSwgRVZFTlRfTkFNRV9FTkFCTEVELCBFVkVOVF9OQU1FX0ZPQ1VTSU4sIEVWRU5UX05BTUVfRk9DVVNPVVQsIEVWRU5UX05BTUVfSElEREVOLCBFVkVOVF9OQU1FX0hJREUsIEVWRU5UX05BTUVfTU9VU0VFTlRFUiwgRVZFTlRfTkFNRV9NT1VTRUxFQVZFLCBFVkVOVF9OQU1FX1NIT1csIEVWRU5UX05BTUVfU0hPV04sIEVWRU5UX09QVElPTlNfTk9fQ0FQVFVSRSwgSE9PS19FVkVOVF9OQU1FX0JFRk9SRV9ERVNUUk9ZLCBIT09LX0VWRU5UX05BTUVfREVTVFJPWUVEIH0gZnJvbSAnLi4vLi4vLi4vY29uc3RhbnRzL2V2ZW50cyc7CmltcG9ydCB7IGFycmF5SW5jbHVkZXMsIGNvbmNhdCwgZnJvbSBhcyBhcnJheUZyb20gfSBmcm9tICcuLi8uLi8uLi91dGlscy9hcnJheSc7CmltcG9ydCB7IGF0dGVtcHRGb2N1cywgY2xvc2VzdCwgY29udGFpbnMsIGdldEF0dHIsIGdldEJ5SWQsIGhhc0F0dHIsIGhhc0NsYXNzLCBpc0Rpc2FibGVkLCBpc0VsZW1lbnQsIGlzVmlzaWJsZSwgcmVtb3ZlQXR0ciwgcmVxdWVzdEFGLCBzZWxlY3QsIHNldEF0dHIgfSBmcm9tICcuLi8uLi8uLi91dGlscy9kb20nOwppbXBvcnQgeyBldmVudE9mZiwgZXZlbnRPbiwgZXZlbnRPbk9mZiwgZ2V0Um9vdEFjdGlvbkV2ZW50TmFtZSwgZ2V0Um9vdEV2ZW50TmFtZSB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2V2ZW50cyc7CmltcG9ydCB7IGdldFNjb3BlSWQgfSBmcm9tICcuLi8uLi8uLi91dGlscy9nZXQtc2NvcGUtaWQnOwppbXBvcnQgeyBpZGVudGl0eSB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2lkZW50aXR5JzsKaW1wb3J0IHsgaXNGdW5jdGlvbiwgaXNOdW1iZXIsIGlzUGxhaW5PYmplY3QsIGlzU3RyaW5nLCBpc1VuZGVmaW5lZCwgaXNVbmRlZmluZWRPck51bGwgfSBmcm9tICcuLi8uLi8uLi91dGlscy9pbnNwZWN0JzsKaW1wb3J0IHsgbG9vc2VFcXVhbCB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL2xvb3NlLWVxdWFsJzsKaW1wb3J0IHsgbWF0aE1heCB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL21hdGgnOwppbXBvcnQgeyBub29wIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvbm9vcCc7CmltcG9ydCB7IHRvSW50ZWdlciB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL251bWJlcic7CmltcG9ydCB7IGtleXMgfSBmcm9tICcuLi8uLi8uLi91dGlscy9vYmplY3QnOwppbXBvcnQgeyB3YXJuIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvd2Fybic7CmltcG9ydCB7IEJ2RXZlbnQgfSBmcm9tICcuLi8uLi8uLi91dGlscy9idi1ldmVudC5jbGFzcyc7CmltcG9ydCB7IGxpc3Rlbk9uUm9vdE1peGluIH0gZnJvbSAnLi4vLi4vLi4vbWl4aW5zL2xpc3Rlbi1vbi1yb290JzsKaW1wb3J0IHsgQlZUb29sdGlwVGVtcGxhdGUgfSBmcm9tICcuL2J2LXRvb2x0aXAtdGVtcGxhdGUnOyAvLyAtLS0gQ29uc3RhbnRzIC0tLQovLyBNb2RhbCBjb250YWluZXIgc2VsZWN0b3IgZm9yIGFwcGVuZGluZyB0b29sdGlwL3BvcG92ZXIKCnZhciBNT0RBTF9TRUxFQ1RPUiA9ICcubW9kYWwtY29udGVudCc7IC8vIE1vZGFsIGAkcm9vdGAgaGlkZGVuIGV2ZW50Cgp2YXIgUk9PVF9FVkVOVF9OQU1FX01PREFMX0hJRERFTiA9IGdldFJvb3RFdmVudE5hbWUoTkFNRV9NT0RBTCwgRVZFTlRfTkFNRV9ISURERU4pOyAvLyBTaWRlYmFyIGNvbnRhaW5lciBzZWxlY3RvciBmb3IgYXBwZW5kaW5nIHRvb2x0aXAvcG9wb3ZlcgoKdmFyIFNJREVCQVJfU0VMRUNUT1IgPSAnLmItc2lkZWJhcic7IC8vIEZvciBmaW5kaW5nIHRoZSBjb250YWluZXIgdG8gYXBwZW5kIHRvCgp2YXIgQ09OVEFJTkVSX1NFTEVDVE9SID0gW01PREFMX1NFTEVDVE9SLCBTSURFQkFSX1NFTEVDVE9SXS5qb2luKCcsICcpOyAvLyBGb3IgZHJvcGRvd24gc25pZmZpbmcKCnZhciBEUk9QRE9XTl9DTEFTUyA9ICdkcm9wZG93bic7CnZhciBEUk9QRE9XTl9PUEVOX1NFTEVDVE9SID0gJy5kcm9wZG93bi1tZW51LnNob3cnOyAvLyBEYXRhIGF0dHJpYnV0ZSB0byB0ZW1wb3Jhcnkgc3RvcmUgdGhlIGB0aXRsZWAgYXR0cmlidXRlJ3MgdmFsdWUKCnZhciBEQVRBX1RJVExFX0FUVFIgPSAnZGF0YS1vcmlnaW5hbC10aXRsZSc7IC8vIERhdGEgc3BlY2lmaWMgdG8gcG9wcGVyIGFuZCB0ZW1wbGF0ZQovLyBXZSBkb24ndCB1c2UgcHJvcHMsIGFzIHdlIG5lZWQgcmVhY3Rpdml0eSAod2UgY2FuJ3QgcGFzcyByZWFjdGl2ZSBwcm9wcykKCnZhciB0ZW1wbGF0ZURhdGEgPSB7CiAgLy8gVGV4dCBzdHJpbmcgb3IgU2NvcGVkIHNsb3QgZnVuY3Rpb24KICB0aXRsZTogJycsCiAgLy8gVGV4dCBzdHJpbmcgb3IgU2NvcGVkIHNsb3QgZnVuY3Rpb24KICBjb250ZW50OiAnJywKICAvLyBTdHJpbmcKICB2YXJpYW50OiBudWxsLAogIC8vIFN0cmluZywgQXJyYXksIE9iamVjdAogIGN1c3RvbUNsYXNzOiBudWxsLAogIC8vIFN0cmluZyBvciBhcnJheSBvZiBTdHJpbmdzIChvdmVyd3JpdHRlbiBieSBCVlBvcHBlcikKICB0cmlnZ2VyczogJycsCiAgLy8gU3RyaW5nIChvdmVyd3JpdHRlbiBieSBCVlBvcHBlcikKICBwbGFjZW1lbnQ6ICdhdXRvJywKICAvLyBTdHJpbmcgb3IgYXJyYXkgb2Ygc3RyaW5ncwogIGZhbGxiYWNrUGxhY2VtZW50OiAnZmxpcCcsCiAgLy8gRWxlbWVudCBvciBDb21wb25lbnQgcmVmZXJlbmNlIChvciBmdW5jdGlvbiB0aGF0IHJldHVybnMgZWxlbWVudCkgb2YKICAvLyB0aGUgZWxlbWVudCB0aGF0IHdpbGwgaGF2ZSB0aGUgdHJpZ2dlciBldmVudHMgYm91bmQsIGFuZCBpcyBhbHNvCiAgLy8gZGVmYXVsdCBlbGVtZW50IGZvciBwb3NpdGlvbmluZwogIHRhcmdldDogbnVsbCwKICAvLyBIVE1MIElELCBFbGVtZW50IG9yIENvbXBvbmVudCByZWZlcmVuY2UKICBjb250YWluZXI6IG51bGwsCiAgLy8gJ2JvZHknCiAgLy8gQm9vbGVhbgogIG5vRmFkZTogZmFsc2UsCiAgLy8gJ3Njcm9sbFBhcmVudCcsICd2aWV3cG9ydCcsICd3aW5kb3cnLCBFbGVtZW50LCBvciBDb21wb25lbnQgcmVmZXJlbmNlCiAgYm91bmRhcnk6ICdzY3JvbGxQYXJlbnQnLAogIC8vIFRvb2x0aXAvcG9wb3ZlciB3aWxsIHRyeSBhbmQgc3RheSBhd2F5IGZyb20KICAvLyBib3VuZGFyeSBlZGdlIGJ5IHRoaXMgbWFueSBwaXhlbHMgKE51bWJlcikKICBib3VuZGFyeVBhZGRpbmc6IDUsCiAgLy8gQXJyb3cgb2Zmc2V0IChOdW1iZXIpCiAgb2Zmc2V0OiAwLAogIC8vIEhvdmVyL2ZvY3VzIGRlbGF5IChOdW1iZXIgb3IgT2JqZWN0KQogIGRlbGF5OiAwLAogIC8vIEFycm93IG9mIFRvb2x0aXAvcG9wb3ZlciB3aWxsIHRyeSBhbmQgc3RheSBhd2F5IGZyb20KICAvLyB0aGUgZWRnZSBvZiB0b29sdGlwL3BvcG92ZXIgZWRnZSBieSB0aGlzIG1hbnkgcGl4ZWxzCiAgYXJyb3dQYWRkaW5nOiA2LAogIC8vIEludGVyYWN0aXZlIHN0YXRlIChCb29sZWFuKQogIGludGVyYWN0aXZlOiB0cnVlLAogIC8vIERpc2FibGVkIHN0YXRlIChCb29sZWFuKQogIGRpc2FibGVkOiBmYWxzZSwKICAvLyBJRCB0byB1c2UgZm9yIHRvb2x0aXAvcG9wb3ZlcgogIGlkOiBudWxsLAogIC8vIEZsYWcgdXNlZCBieSBkaXJlY3RpdmVzIG9ubHksIGZvciBIVE1MIGNvbnRlbnQKICBodG1sOiBmYWxzZQp9OyAvLyAtLS0gTWFpbiBjb21wb25lbnQgLS0tCi8vIEB2dWUvY29tcG9uZW50CgpleHBvcnQgdmFyIEJWVG9vbHRpcCA9IC8qI19fUFVSRV9fKi9WdWUuZXh0ZW5kKHsKICBuYW1lOiBOQU1FX1RPT0xUSVBfSEVMUEVSLAogIG1peGluczogW2xpc3Rlbk9uUm9vdE1peGluXSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdGVtcGxhdGVEYXRhKSwge30sIHsKICAgICAgLy8gU3RhdGUgbWFuYWdlbWVudCBkYXRhCiAgICAgIGFjdGl2ZVRyaWdnZXI6IHsKICAgICAgICAvLyBtYW51YWw6IGZhbHNlLAogICAgICAgIGhvdmVyOiBmYWxzZSwKICAgICAgICBjbGljazogZmFsc2UsCiAgICAgICAgZm9jdXM6IGZhbHNlCiAgICAgIH0sCiAgICAgIGxvY2FsU2hvdzogZmFsc2UKICAgIH0pOwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHRlbXBsYXRlVHlwZTogZnVuY3Rpb24gdGVtcGxhdGVUeXBlKCkgewogICAgICAvLyBPdmVyd3JpdHRlbiBieSBCVlBvcG92ZXIKICAgICAgcmV0dXJuICd0b29sdGlwJzsKICAgIH0sCiAgICBjb21wdXRlZElkOiBmdW5jdGlvbiBjb21wdXRlZElkKCkgewogICAgICByZXR1cm4gdGhpcy5pZCB8fCAiX19idl8iLmNvbmNhdCh0aGlzLnRlbXBsYXRlVHlwZSwgIl8iKS5jb25jYXQodGhpc1tDT01QT05FTlRfVUlEX0tFWV0sICJfXyIpOwogICAgfSwKICAgIGNvbXB1dGVkRGVsYXk6IGZ1bmN0aW9uIGNvbXB1dGVkRGVsYXkoKSB7CiAgICAgIC8vIE5vcm1hbGl6ZXMgZGVsYXkgaW50byBvYmplY3QgZm9ybQogICAgICB2YXIgZGVsYXkgPSB7CiAgICAgICAgc2hvdzogMCwKICAgICAgICBoaWRlOiAwCiAgICAgIH07CgogICAgICBpZiAoaXNQbGFpbk9iamVjdCh0aGlzLmRlbGF5KSkgewogICAgICAgIGRlbGF5LnNob3cgPSBtYXRoTWF4KHRvSW50ZWdlcih0aGlzLmRlbGF5LnNob3csIDApLCAwKTsKICAgICAgICBkZWxheS5oaWRlID0gbWF0aE1heCh0b0ludGVnZXIodGhpcy5kZWxheS5oaWRlLCAwKSwgMCk7CiAgICAgIH0gZWxzZSBpZiAoaXNOdW1iZXIodGhpcy5kZWxheSkgfHwgaXNTdHJpbmcodGhpcy5kZWxheSkpIHsKICAgICAgICBkZWxheS5zaG93ID0gZGVsYXkuaGlkZSA9IG1hdGhNYXgodG9JbnRlZ2VyKHRoaXMuZGVsYXksIDApLCAwKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGRlbGF5OwogICAgfSwKICAgIGNvbXB1dGVkVHJpZ2dlcnM6IGZ1bmN0aW9uIGNvbXB1dGVkVHJpZ2dlcnMoKSB7CiAgICAgIC8vIFJldHVybnMgdGhlIHRyaWdnZXJzIGluIHNvcnRlZCBhcnJheSBmb3JtCiAgICAgIC8vIFRPRE86IFN3aXRjaCB0aGlzIHRvIG9iamVjdCBmb3JtIGZvciBlYXNpZXIgbG9va3VwCiAgICAgIHJldHVybiBjb25jYXQodGhpcy50cmlnZ2VycykuZmlsdGVyKGlkZW50aXR5KS5qb2luKCcgJykudHJpbSgpLnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xzKy8pLnNvcnQoKTsKICAgIH0sCiAgICBpc1dpdGhBY3RpdmVUcmlnZ2VyOiBmdW5jdGlvbiBpc1dpdGhBY3RpdmVUcmlnZ2VyKCkgewogICAgICBmb3IgKHZhciB0cmlnZ2VyIGluIHRoaXMuYWN0aXZlVHJpZ2dlcikgewogICAgICAgIGlmICh0aGlzLmFjdGl2ZVRyaWdnZXJbdHJpZ2dlcl0pIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIGNvbXB1dGVkVGVtcGxhdGVEYXRhOiBmdW5jdGlvbiBjb21wdXRlZFRlbXBsYXRlRGF0YSgpIHsKICAgICAgdmFyIHRpdGxlID0gdGhpcy50aXRsZSwKICAgICAgICAgIGNvbnRlbnQgPSB0aGlzLmNvbnRlbnQsCiAgICAgICAgICB2YXJpYW50ID0gdGhpcy52YXJpYW50LAogICAgICAgICAgY3VzdG9tQ2xhc3MgPSB0aGlzLmN1c3RvbUNsYXNzLAogICAgICAgICAgbm9GYWRlID0gdGhpcy5ub0ZhZGUsCiAgICAgICAgICBpbnRlcmFjdGl2ZSA9IHRoaXMuaW50ZXJhY3RpdmU7CiAgICAgIHJldHVybiB7CiAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgIGNvbnRlbnQ6IGNvbnRlbnQsCiAgICAgICAgdmFyaWFudDogdmFyaWFudCwKICAgICAgICBjdXN0b21DbGFzczogY3VzdG9tQ2xhc3MsCiAgICAgICAgbm9GYWRlOiBub0ZhZGUsCiAgICAgICAgaW50ZXJhY3RpdmU6IGludGVyYWN0aXZlCiAgICAgIH07CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgY29tcHV0ZWRUcmlnZ2VyczogZnVuY3Rpb24gY29tcHV0ZWRUcmlnZ2VycyhuZXdUcmlnZ2Vycywgb2xkVHJpZ2dlcnMpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsgLy8gVHJpZ2dlcnMgaGF2ZSBjaGFuZ2VkLCBzbyByZS1yZWdpc3RlciB0aGVtCgogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoKCiAgICAgIGlmICghbG9vc2VFcXVhbChuZXdUcmlnZ2Vycywgb2xkVHJpZ2dlcnMpKSB7CiAgICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gRGlzYWJsZSB0cmlnZ2VyIGxpc3RlbmVycwogICAgICAgICAgX3RoaXMudW5MaXN0ZW4oKTsgLy8gQ2xlYXIgYW55IGFjdGl2ZSB0cmlnZ2VycyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIGxpc3Qgb2YgdHJpZ2dlcnMKCgogICAgICAgICAgb2xkVHJpZ2dlcnMuZm9yRWFjaChmdW5jdGlvbiAodHJpZ2dlcikgewogICAgICAgICAgICBpZiAoIWFycmF5SW5jbHVkZXMobmV3VHJpZ2dlcnMsIHRyaWdnZXIpKSB7CiAgICAgICAgICAgICAgaWYgKF90aGlzLmFjdGl2ZVRyaWdnZXJbdHJpZ2dlcl0pIHsKICAgICAgICAgICAgICAgIF90aGlzLmFjdGl2ZVRyaWdnZXJbdHJpZ2dlcl0gPSBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOyAvLyBSZS1lbmFibGUgdGhlIHRyaWdnZXIgbGlzdGVuZXJzCgogICAgICAgICAgX3RoaXMubGlzdGVuKCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBjb21wdXRlZFRlbXBsYXRlRGF0YTogZnVuY3Rpb24gY29tcHV0ZWRUZW1wbGF0ZURhdGEoKSB7CiAgICAgIC8vIElmIGFueSBvZiB0aGUgd2hpbGUgb3BlbiByZWFjdGl2ZSAicHJvcHMiIGNoYW5nZSwKICAgICAgLy8gZW5zdXJlIHRoYXQgdGhlIHRlbXBsYXRlIHVwZGF0ZXMgYWNjb3JkaW5nbHkKICAgICAgdGhpcy5oYW5kbGVUZW1wbGF0ZVVwZGF0ZSgpOwogICAgfSwKICAgIHRpdGxlOiBmdW5jdGlvbiB0aXRsZShuZXdWYWx1ZSwgb2xkVmFsdWUpIHsKICAgICAgLy8gTWFrZSBzdXJlIHRvIGhpZGUgdGhlIHRvb2x0aXAgd2hlbiB0aGUgdGl0bGUgaXMgc2V0IGVtcHR5CiAgICAgIGlmIChuZXdWYWx1ZSAhPT0gb2xkVmFsdWUgJiYgIW5ld1ZhbHVlKSB7CiAgICAgICAgdGhpcy5oaWRlKCk7CiAgICAgIH0KICAgIH0sCiAgICBkaXNhYmxlZDogZnVuY3Rpb24gZGlzYWJsZWQobmV3VmFsdWUpIHsKICAgICAgaWYgKG5ld1ZhbHVlKSB7CiAgICAgICAgdGhpcy5kaXNhYmxlKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5lbmFibGUoKTsKICAgICAgfQogICAgfQogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHZhciBfdGhpczIgPSB0aGlzOyAvLyBDcmVhdGUgbm9uLXJlYWN0aXZlIHByb3BlcnRpZXMKCgogICAgdGhpcy4kX3RpcCA9IG51bGw7CiAgICB0aGlzLiRfaG92ZXJUaW1lb3V0ID0gbnVsbDsKICAgIHRoaXMuJF9ob3ZlclN0YXRlID0gJyc7CiAgICB0aGlzLiRfdmlzaWJsZUludGVydmFsID0gbnVsbDsKICAgIHRoaXMuJF9lbmFibGVkID0gIXRoaXMuZGlzYWJsZWQ7CiAgICB0aGlzLiRfbm9vcCA9IG5vb3AuYmluZCh0aGlzKTsgLy8gRGVzdHJveSBvdXJzZWx2ZXMgd2hlbiB0aGUgcGFyZW50IGlzIGRlc3Ryb3llZAoKICAgIGlmICh0aGlzLiRwYXJlbnQpIHsKICAgICAgdGhpcy4kcGFyZW50LiRvbmNlKEhPT0tfRVZFTlRfTkFNRV9CRUZPUkVfREVTVFJPWSwgZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzMi4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8gSW4gYSBgcmVxdWVzdEFGKClgIHRvIHJlbGVhc2UgY29udHJvbCBiYWNrIHRvIGFwcGxpY2F0aW9uCiAgICAgICAgICByZXF1ZXN0QUYoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczIuJGRlc3Ryb3koKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgIHZhciB0YXJnZXQgPSBfdGhpczIuZ2V0VGFyZ2V0KCk7CgogICAgICBpZiAodGFyZ2V0ICYmIGNvbnRhaW5zKGRvY3VtZW50LmJvZHksIHRhcmdldCkpIHsKICAgICAgICAvLyBDb3B5IHRoZSBwYXJlbnQncyBzY29wZWQgc3R5bGUgYXR0cmlidXRlCiAgICAgICAgX3RoaXMyLnNjb3BlSWQgPSBnZXRTY29wZUlkKF90aGlzMi4kcGFyZW50KTsgLy8gU2V0IHVwIGFsbCB0cmlnZ2VyIGhhbmRsZXJzIGFuZCBsaXN0ZW5lcnMKCiAgICAgICAgX3RoaXMyLmxpc3RlbigpOwogICAgICB9IGVsc2UgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgd2Fybihpc1N0cmluZyhfdGhpczIudGFyZ2V0KSA/ICJVbmFibGUgdG8gZmluZCB0YXJnZXQgZWxlbWVudCBieSBJRCBcIiMiLmNvbmNhdChfdGhpczIudGFyZ2V0LCAiXCIgaW4gZG9jdW1lbnQuIikgOiAnVGhlIHByb3ZpZGVkIHRhcmdldCBpcyBubyB2YWxpZCBIVE1MIGVsZW1lbnQuJywgX3RoaXMyLnRlbXBsYXRlVHlwZSk7CiAgICAgIH0KICAgIH0pOwogIH0sCgogIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgdXBkYXRlZDogZnVuY3Rpb24gdXBkYXRlZCgpIHsKICAgIC8vIFVzdWFsbHkgY2FsbGVkIHdoZW4gdGhlIHNsb3RzL2RhdGEgY2hhbmdlcwogICAgdGhpcy4kbmV4dFRpY2sodGhpcy5oYW5kbGVUZW1wbGF0ZVVwZGF0ZSk7CiAgfSwKCiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICBkZWFjdGl2YXRlZDogZnVuY3Rpb24gZGVhY3RpdmF0ZWQoKSB7CiAgICAvLyBJbiBhIGtlZXBhbGl2ZSB0aGF0IGhhcyBiZWVuIGRlYWN0aXZhdGVkLCBzbyBoaWRlCiAgICAvLyB0aGUgdG9vbHRpcC9wb3BvdmVyIGlmIGl0IGlzIHNob3dpbmcKICAgIHRoaXMuZm9yY2VIaWRlKCk7CiAgfSwKICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiBiZWZvcmVEZXN0cm95KCkgewogICAgLy8gUmVtb3ZlIGFsbCBoYW5kbGVyL2xpc3RlbmVycwogICAgdGhpcy51bkxpc3RlbigpOwogICAgdGhpcy5zZXRXaGlsZU9wZW5MaXN0ZW5lcnMoZmFsc2UpOyAvLyBDbGVhciBhbnkgdGltZW91dHMvaW50ZXJ2YWxzCgogICAgdGhpcy5jbGVhckhvdmVyVGltZW91dCgpOwogICAgdGhpcy5jbGVhclZpc2liaWxpdHlJbnRlcnZhbCgpOyAvLyBEZXN0cm95IHRoZSB0ZW1wbGF0ZQoKICAgIHRoaXMuZGVzdHJveVRlbXBsYXRlKCk7IC8vIFJlbW92ZSBhbnkgb3RoZXIgcHJpdmF0ZSBwcm9wZXJ0aWVzIGNyZWF0ZWQgZHVyaW5nIGNyZWF0ZQoKICAgIHRoaXMuJF9ub29wID0gbnVsbDsKICB9LAogIG1ldGhvZHM6IHsKICAgIC8vIC0tLSBNZXRob2RzIGZvciBjcmVhdGluZyBhbmQgZGVzdHJveWluZyB0aGUgdGVtcGxhdGUgLS0tCiAgICBnZXRUZW1wbGF0ZTogZnVuY3Rpb24gZ2V0VGVtcGxhdGUoKSB7CiAgICAgIC8vIE92ZXJyaWRkZW4gYnkgQlZQb3BvdmVyCiAgICAgIHJldHVybiBCVlRvb2x0aXBUZW1wbGF0ZTsKICAgIH0sCiAgICB1cGRhdGVEYXRhOiBmdW5jdGlvbiB1cGRhdGVEYXRhKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBkYXRhID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB7fTsgLy8gTWV0aG9kIGZvciB1cGRhdGluZyBwb3BwZXIvdGVtcGxhdGUgZGF0YQogICAgICAvLyBXZSBvbmx5IHVwZGF0ZSBkYXRhIGlmIGl0IGV4aXN0cywgYW5kIGhhcyBub3QgY2hhbmdlZAoKICAgICAgdmFyIHRpdGxlVXBkYXRlZCA9IGZhbHNlOwogICAgICBrZXlzKHRlbXBsYXRlRGF0YSkuZm9yRWFjaChmdW5jdGlvbiAocHJvcCkgewogICAgICAgIGlmICghaXNVbmRlZmluZWQoZGF0YVtwcm9wXSkgJiYgX3RoaXMzW3Byb3BdICE9PSBkYXRhW3Byb3BdKSB7CiAgICAgICAgICBfdGhpczNbcHJvcF0gPSBkYXRhW3Byb3BdOwoKICAgICAgICAgIGlmIChwcm9wID09PSAndGl0bGUnKSB7CiAgICAgICAgICAgIHRpdGxlVXBkYXRlZCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsgLy8gSWYgdGhlIHRpdGxlIGhhcyB1cGRhdGVkLCB3ZSBtYXkgbmVlZCB0byBoYW5kbGUgdGhlIGB0aXRsZWAKICAgICAgLy8gYXR0cmlidXRlIG9uIHRoZSB0cmlnZ2VyIHRhcmdldAogICAgICAvLyBXZSBvbmx5IGRvIHRoaXMgd2hpbGUgdGhlIHRlbXBsYXRlIGlzIG9wZW4KCiAgICAgIGlmICh0aXRsZVVwZGF0ZWQgJiYgdGhpcy5sb2NhbFNob3cpIHsKICAgICAgICB0aGlzLmZpeFRpdGxlKCk7CiAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVUZW1wbGF0ZUFuZFNob3c6IGZ1bmN0aW9uIGNyZWF0ZVRlbXBsYXRlQW5kU2hvdygpIHsKICAgICAgLy8gQ3JlYXRlcyB0aGUgdGVtcGxhdGUgaW5zdGFuY2UgYW5kIHNob3cgaXQKICAgICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuZ2V0Q29udGFpbmVyKCk7CiAgICAgIHZhciBUZW1wbGF0ZSA9IHRoaXMuZ2V0VGVtcGxhdGUoKTsKICAgICAgdmFyICR0aXAgPSB0aGlzLiRfdGlwID0gbmV3IFRlbXBsYXRlKHsKICAgICAgICBwYXJlbnQ6IHRoaXMsCiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBpcyBub3QgcmVhY3RpdmUgdG8gY2hhbmdlcyBpbiB0aGUgcHJvcHMgZGF0YQogICAgICAgIHByb3BzRGF0YTogewogICAgICAgICAgLy8gVGhlc2UgdmFsdWVzIGNhbm5vdCBiZSBjaGFuZ2VkIHdoaWxlIHRlbXBsYXRlIGlzIHNob3dpbmcKICAgICAgICAgIGlkOiB0aGlzLmNvbXB1dGVkSWQsCiAgICAgICAgICBodG1sOiB0aGlzLmh0bWwsCiAgICAgICAgICBwbGFjZW1lbnQ6IHRoaXMucGxhY2VtZW50LAogICAgICAgICAgZmFsbGJhY2tQbGFjZW1lbnQ6IHRoaXMuZmFsbGJhY2tQbGFjZW1lbnQsCiAgICAgICAgICB0YXJnZXQ6IHRoaXMuZ2V0UGxhY2VtZW50VGFyZ2V0KCksCiAgICAgICAgICBib3VuZGFyeTogdGhpcy5nZXRCb3VuZGFyeSgpLAogICAgICAgICAgLy8gRW5zdXJlIHRoZSBmb2xsb3dpbmcgYXJlIGludGVnZXJzCiAgICAgICAgICBvZmZzZXQ6IHRvSW50ZWdlcih0aGlzLm9mZnNldCwgMCksCiAgICAgICAgICBhcnJvd1BhZGRpbmc6IHRvSW50ZWdlcih0aGlzLmFycm93UGFkZGluZywgMCksCiAgICAgICAgICBib3VuZGFyeVBhZGRpbmc6IHRvSW50ZWdlcih0aGlzLmJvdW5kYXJ5UGFkZGluZywgMCkKICAgICAgICB9CiAgICAgIH0pOyAvLyBXZSBzZXQgdGhlIGluaXRpYWwgcmVhY3RpdmUgZGF0YSAodmFsdWVzIHRoYXQgY2FuIGJlIGNoYW5nZWQgd2hpbGUgb3BlbikKCiAgICAgIHRoaXMuaGFuZGxlVGVtcGxhdGVVcGRhdGUoKTsgLy8gVGVtcGxhdGUgdHJhbnNpdGlvbiBwaGFzZSBldmVudHMgKGhhbmRsZWQgb25jZSBvbmx5KQogICAgICAvLyBXaGVuIHRoZSB0ZW1wbGF0ZSBoYXMgbW91bnRlZCwgYnV0IG5vdCB2aXNpYmx5IHNob3duIHlldAoKICAgICAgJHRpcC4kb25jZShFVkVOVF9OQU1FX1NIT1csIHRoaXMub25UZW1wbGF0ZVNob3cpOyAvLyBXaGVuIHRoZSB0ZW1wbGF0ZSBoYXMgY29tcGxldGVkIHNob3dpbmcKCiAgICAgICR0aXAuJG9uY2UoRVZFTlRfTkFNRV9TSE9XTiwgdGhpcy5vblRlbXBsYXRlU2hvd24pOyAvLyBXaGVuIHRoZSB0ZW1wbGF0ZSBoYXMgc3RhcnRlZCB0byBoaWRlCgogICAgICAkdGlwLiRvbmNlKEVWRU5UX05BTUVfSElERSwgdGhpcy5vblRlbXBsYXRlSGlkZSk7IC8vIFdoZW4gdGhlIHRlbXBsYXRlIGhhcyBjb21wbGV0ZWQgaGlkaW5nCgogICAgICAkdGlwLiRvbmNlKEVWRU5UX05BTUVfSElEREVOLCB0aGlzLm9uVGVtcGxhdGVIaWRkZW4pOyAvLyBXaGVuIHRoZSB0ZW1wbGF0ZSBnZXRzIGRlc3Ryb3llZCBmb3IgYW55IHJlYXNvbgoKICAgICAgJHRpcC4kb25jZShIT09LX0VWRU5UX05BTUVfREVTVFJPWUVELCB0aGlzLmRlc3Ryb3lUZW1wbGF0ZSk7IC8vIENvbnZlbmllbmNlIGV2ZW50cyBmcm9tIHRlbXBsYXRlCiAgICAgIC8vIFRvIHNhdmUgdXMgZnJvbSBtYW51YWxseSBhZGRpbmcvcmVtb3ZpbmcgRE9NCiAgICAgIC8vIGxpc3RlbmVycyB0byB0aXAgZWxlbWVudCB3aGVuIGl0IGlzIG9wZW4KCiAgICAgICR0aXAuJG9uKEVWRU5UX05BTUVfRk9DVVNJTiwgdGhpcy5oYW5kbGVFdmVudCk7CiAgICAgICR0aXAuJG9uKEVWRU5UX05BTUVfRk9DVVNPVVQsIHRoaXMuaGFuZGxlRXZlbnQpOwogICAgICAkdGlwLiRvbihFVkVOVF9OQU1FX01PVVNFRU5URVIsIHRoaXMuaGFuZGxlRXZlbnQpOwogICAgICAkdGlwLiRvbihFVkVOVF9OQU1FX01PVVNFTEVBVkUsIHRoaXMuaGFuZGxlRXZlbnQpOyAvLyBNb3VudCAod2hpY2ggdHJpZ2dlcnMgdGhlIGBzaG93YCkKCiAgICAgICR0aXAuJG1vdW50KGNvbnRhaW5lci5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSkpOyAvLyBUZW1wbGF0ZSB3aWxsIGF1dG9tYXRpY2FsbHkgcmVtb3ZlIGl0cyBtYXJrdXAgZnJvbSBET00gd2hlbiBoaWRkZW4KICAgIH0sCiAgICBoaWRlVGVtcGxhdGU6IGZ1bmN0aW9uIGhpZGVUZW1wbGF0ZSgpIHsKICAgICAgLy8gVHJpZ2dlciB0aGUgdGVtcGxhdGUgdG8gc3RhcnQgaGlkaW5nCiAgICAgIC8vIFRoZSB0ZW1wbGF0ZSB3aWxsIGVtaXQgdGhlIGBoaWRlYCBldmVudCBhZnRlciB0aGlzIGFuZAogICAgICAvLyB0aGVuIGVtaXQgdGhlIGBoaWRkZW5gIGV2ZW50IG9uY2UgaXQgaXMgZnVsbHkgaGlkZGVuCiAgICAgIC8vIFRoZSBgaG9vazpkZXN0cm95ZWRgIHdpbGwgYWxzbyBiZSBjYWxsZWQgKHNhZmV0eSBtZWFzdXJlKQogICAgICB0aGlzLiRfdGlwICYmIHRoaXMuJF90aXAuaGlkZSgpOyAvLyBDbGVhciBvdXQgYW55IHN0cmFnZ2luZyBhY3RpdmUgdHJpZ2dlcnMKCiAgICAgIHRoaXMuY2xlYXJBY3RpdmVUcmlnZ2VycygpOyAvLyBSZXNldCB0aGUgaG92ZXIgc3RhdGUKCiAgICAgIHRoaXMuJF9ob3ZlclN0YXRlID0gJyc7CiAgICB9LAogICAgLy8gRGVzdHJveSB0aGUgdGVtcGxhdGUgaW5zdGFuY2UgYW5kIHJlc2V0IHN0YXRlCiAgICBkZXN0cm95VGVtcGxhdGU6IGZ1bmN0aW9uIGRlc3Ryb3lUZW1wbGF0ZSgpIHsKICAgICAgdGhpcy5zZXRXaGlsZU9wZW5MaXN0ZW5lcnMoZmFsc2UpOwogICAgICB0aGlzLmNsZWFySG92ZXJUaW1lb3V0KCk7CiAgICAgIHRoaXMuJF9ob3ZlclN0YXRlID0gJyc7CiAgICAgIHRoaXMuY2xlYXJBY3RpdmVUcmlnZ2VycygpOwogICAgICB0aGlzLmxvY2FsUGxhY2VtZW50VGFyZ2V0ID0gbnVsbDsKCiAgICAgIHRyeSB7CiAgICAgICAgdGhpcy4kX3RpcC4kZGVzdHJveSgpOwogICAgICB9IGNhdGNoIChfdW51c2VkKSB7fQoKICAgICAgdGhpcy4kX3RpcCA9IG51bGw7CiAgICAgIHRoaXMucmVtb3ZlQXJpYURlc2NyaWJlZGJ5KCk7CiAgICAgIHRoaXMucmVzdG9yZVRpdGxlKCk7CiAgICAgIHRoaXMubG9jYWxTaG93ID0gZmFsc2U7CiAgICB9LAogICAgZ2V0VGVtcGxhdGVFbGVtZW50OiBmdW5jdGlvbiBnZXRUZW1wbGF0ZUVsZW1lbnQoKSB7CiAgICAgIHJldHVybiB0aGlzLiRfdGlwID8gdGhpcy4kX3RpcC4kZWwgOiBudWxsOwogICAgfSwKICAgIGhhbmRsZVRlbXBsYXRlVXBkYXRlOiBmdW5jdGlvbiBoYW5kbGVUZW1wbGF0ZVVwZGF0ZSgpIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7IC8vIFVwZGF0ZSBvdXIgdGVtcGxhdGUgdGl0bGUvY29udGVudCAicHJvcHMiCiAgICAgIC8vIFNvIHRoYXQgdGhlIHRlbXBsYXRlIHVwZGF0ZXMgYWNjb3JkaW5nbHkKCgogICAgICB2YXIgJHRpcCA9IHRoaXMuJF90aXA7CgogICAgICBpZiAoJHRpcCkgewogICAgICAgIHZhciBwcm9wcyA9IFsndGl0bGUnLCAnY29udGVudCcsICd2YXJpYW50JywgJ2N1c3RvbUNsYXNzJywgJ25vRmFkZScsICdpbnRlcmFjdGl2ZSddOyAvLyBPbmx5IHVwZGF0ZSB0aGUgdmFsdWVzIGlmIHRoZXkgaGF2ZSBjaGFuZ2VkCgogICAgICAgIHByb3BzLmZvckVhY2goZnVuY3Rpb24gKHByb3ApIHsKICAgICAgICAgIGlmICgkdGlwW3Byb3BdICE9PSBfdGhpczRbcHJvcF0pIHsKICAgICAgICAgICAgJHRpcFtwcm9wXSA9IF90aGlzNFtwcm9wXTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIC8vIC0tLSBTaG93L0hpZGUgaGFuZGxlcnMgLS0tCiAgICAvLyBTaG93IHRoZSB0b29sdGlwCiAgICBzaG93OiBmdW5jdGlvbiBzaG93KCkgewogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoKTsKCiAgICAgIGlmICghdGFyZ2V0IHx8ICFjb250YWlucyhkb2N1bWVudC5ib2R5LCB0YXJnZXQpIHx8ICFpc1Zpc2libGUodGFyZ2V0KSB8fCB0aGlzLmRyb3Bkb3duT3BlbigpIHx8IChpc1VuZGVmaW5lZE9yTnVsbCh0aGlzLnRpdGxlKSB8fCB0aGlzLnRpdGxlID09PSAnJykgJiYgKGlzVW5kZWZpbmVkT3JOdWxsKHRoaXMuY29udGVudCkgfHwgdGhpcy5jb250ZW50ID09PSAnJykpIHsKICAgICAgICAvLyBJZiB0cmlnZ2VyIGVsZW1lbnQgaXNuJ3QgaW4gdGhlIERPTSBvciBpcyBub3QgdmlzaWJsZSwgb3IKICAgICAgICAvLyBpcyBvbiBhbiBvcGVuIGRyb3Bkb3duIHRvZ2dsZSwgb3IgaGFzIG5vIGNvbnRlbnQsIHRoZW4KICAgICAgICAvLyB3ZSBleGl0IHdpdGhvdXQgc2hvd2luZwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBJZiB0aXAgYWxyZWFkeSBleGlzdHMsIGV4aXQgZWFybHkKCgogICAgICBpZiAodGhpcy4kX3RpcCB8fCB0aGlzLmxvY2FsU2hvdykgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIEluIHRoZSBwcm9jZXNzIG9mIHNob3dpbmcKCgogICAgICB0aGlzLmxvY2FsU2hvdyA9IHRydWU7IC8vIENyZWF0ZSBhIGNhbmNlbGFibGUgQnZFdmVudAoKICAgICAgdmFyIHNob3dFdnQgPSB0aGlzLmJ1aWxkRXZlbnQoRVZFTlRfTkFNRV9TSE9XLCB7CiAgICAgICAgY2FuY2VsYWJsZTogdHJ1ZQogICAgICB9KTsKICAgICAgdGhpcy5lbWl0RXZlbnQoc2hvd0V2dCk7IC8vIERvbid0IHNob3cgaWYgZXZlbnQgY2FuY2VsbGVkCgogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgICAgIGlmIChzaG93RXZ0LmRlZmF1bHRQcmV2ZW50ZWQpIHsKICAgICAgICAvLyBEZXN0cm95IHRoZSB0ZW1wbGF0ZSAoaWYgZm9yIHNvbWUgcmVhc29uIGl0IHdhcyBjcmVhdGVkKQogICAgICAgIHRoaXMuZGVzdHJveVRlbXBsYXRlKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIEZpeCB0aGUgdGl0bGUgYXR0cmlidXRlIG9uIHRhcmdldAoKCiAgICAgIHRoaXMuZml4VGl0bGUoKTsgLy8gU2V0IGFyaWEtZGVzY3JpYmVkYnkgb24gdGFyZ2V0CgogICAgICB0aGlzLmFkZEFyaWFEZXNjcmliZWRieSgpOyAvLyBDcmVhdGUgYW5kIHNob3cgdGhlIHRvb2x0aXAKCiAgICAgIHRoaXMuY3JlYXRlVGVtcGxhdGVBbmRTaG93KCk7CiAgICB9LAogICAgaGlkZTogZnVuY3Rpb24gaGlkZSgpIHsKICAgICAgdmFyIGZvcmNlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBmYWxzZTsgLy8gSGlkZSB0aGUgdG9vbHRpcAoKICAgICAgdmFyIHRpcCA9IHRoaXMuZ2V0VGVtcGxhdGVFbGVtZW50KCk7CiAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKICAgICAgaWYgKCF0aXAgfHwgIXRoaXMubG9jYWxTaG93KSB7CiAgICAgICAgdGhpcy5yZXN0b3JlVGl0bGUoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gRW1pdCBjYW5jZWxhYmxlIEJ2RXZlbnQgJ2hpZGUnCiAgICAgIC8vIFdlIGRpc2FibGUgY2FuY2VsbGluZyBpZiBgZm9yY2VgIGlzIHRydWUKCgogICAgICB2YXIgaGlkZUV2dCA9IHRoaXMuYnVpbGRFdmVudChFVkVOVF9OQU1FX0hJREUsIHsKICAgICAgICBjYW5jZWxhYmxlOiAhZm9yY2UKICAgICAgfSk7CiAgICAgIHRoaXMuZW1pdEV2ZW50KGhpZGVFdnQpOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWY6IGlnbm9yZSBmb3Igbm93ICovCgogICAgICBpZiAoaGlkZUV2dC5kZWZhdWx0UHJldmVudGVkKSB7CiAgICAgICAgLy8gRG9uJ3QgaGlkZSBpZiBldmVudCBjYW5jZWxsZWQKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gVGVsbCB0aGUgdGVtcGxhdGUgdG8gaGlkZQoKCiAgICAgIHRoaXMuaGlkZVRlbXBsYXRlKCk7CiAgICB9LAogICAgZm9yY2VIaWRlOiBmdW5jdGlvbiBmb3JjZUhpZGUoKSB7CiAgICAgIC8vIEZvcmNlZnVsbHkgaGlkZXMvZGVzdHJveXMgdGhlIHRlbXBsYXRlLCByZWdhcmRsZXNzIG9mIGFueSBhY3RpdmUgdHJpZ2dlcnMKICAgICAgdmFyIHRpcCA9IHRoaXMuZ2V0VGVtcGxhdGVFbGVtZW50KCk7CgogICAgICBpZiAoIXRpcCB8fCAhdGhpcy5sb2NhbFNob3cpIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBEaXNhYmxlIHdoaWxlIG9wZW4gbGlzdGVuZXJzL3dhdGNoZXJzCiAgICAgIC8vIFRoaXMgaXMgYWxzbyBkb25lIGluIHRoZSB0ZW1wbGF0ZSBgaGlkZWAgZXZlbnQgaGFuZGxlcgoKCiAgICAgIHRoaXMuc2V0V2hpbGVPcGVuTGlzdGVuZXJzKGZhbHNlKTsgLy8gQ2xlYXIgYW55IGhvdmVyIGVudGVyL2xlYXZlIGV2ZW50CgogICAgICB0aGlzLmNsZWFySG92ZXJUaW1lb3V0KCk7CiAgICAgIHRoaXMuJF9ob3ZlclN0YXRlID0gJyc7CiAgICAgIHRoaXMuY2xlYXJBY3RpdmVUcmlnZ2VycygpOyAvLyBEaXNhYmxlIHRoZSBmYWRlIGFuaW1hdGlvbiBvbiB0aGUgdGVtcGxhdGUKCiAgICAgIGlmICh0aGlzLiRfdGlwKSB7CiAgICAgICAgdGhpcy4kX3RpcC5ub0ZhZGUgPSB0cnVlOwogICAgICB9IC8vIEhpZGUgdGhlIHRpcCAod2l0aCBmb3JjZSA9IHRydWUpCgoKICAgICAgdGhpcy5oaWRlKHRydWUpOwogICAgfSwKICAgIGVuYWJsZTogZnVuY3Rpb24gZW5hYmxlKCkgewogICAgICB0aGlzLiRfZW5hYmxlZCA9IHRydWU7IC8vIENyZWF0ZSBhIG5vbi1jYW5jZWxhYmxlIEJ2RXZlbnQKCiAgICAgIHRoaXMuZW1pdEV2ZW50KHRoaXMuYnVpbGRFdmVudChFVkVOVF9OQU1FX0VOQUJMRUQpKTsKICAgIH0sCiAgICBkaXNhYmxlOiBmdW5jdGlvbiBkaXNhYmxlKCkgewogICAgICB0aGlzLiRfZW5hYmxlZCA9IGZhbHNlOyAvLyBDcmVhdGUgYSBub24tY2FuY2VsYWJsZSBCdkV2ZW50CgogICAgICB0aGlzLmVtaXRFdmVudCh0aGlzLmJ1aWxkRXZlbnQoRVZFTlRfTkFNRV9ESVNBQkxFRCkpOwogICAgfSwKICAgIC8vIC0tLSBIYW5kbGVycyBmb3IgdGVtcGxhdGUgZXZlbnRzIC0tLQogICAgLy8gV2hlbiB0ZW1wbGF0ZSBpcyBpbnNlcnRlZCBpbnRvIERPTSwgYnV0IG5vdCB5ZXQgc2hvd24KICAgIG9uVGVtcGxhdGVTaG93OiBmdW5jdGlvbiBvblRlbXBsYXRlU2hvdygpIHsKICAgICAgLy8gRW5hYmxlIHdoaWxlIG9wZW4gbGlzdGVuZXJzL3dhdGNoZXJzCiAgICAgIHRoaXMuc2V0V2hpbGVPcGVuTGlzdGVuZXJzKHRydWUpOwogICAgfSwKICAgIC8vIFdoZW4gdGVtcGxhdGUgc2hvdyB0cmFuc2l0aW9uIGNvbXBsZXRlcwogICAgb25UZW1wbGF0ZVNob3duOiBmdW5jdGlvbiBvblRlbXBsYXRlU2hvd24oKSB7CiAgICAgIHZhciBwcmV2SG92ZXJTdGF0ZSA9IHRoaXMuJF9ob3ZlclN0YXRlOwogICAgICB0aGlzLiRfaG92ZXJTdGF0ZSA9ICcnOwogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dDogb2NjYXNpb25hbCBOb2RlIDEwIGNvdmVyYWdlIGVycm9yICovCgogICAgICBpZiAocHJldkhvdmVyU3RhdGUgPT09ICdvdXQnKSB7CiAgICAgICAgdGhpcy5sZWF2ZShudWxsKTsKICAgICAgfSAvLyBFbWl0IGEgbm9uLWNhbmNlbGFibGUgQnZFdmVudCAnc2hvd24nCgoKICAgICAgdGhpcy5lbWl0RXZlbnQodGhpcy5idWlsZEV2ZW50KEVWRU5UX05BTUVfU0hPV04pKTsKICAgIH0sCiAgICAvLyBXaGVuIHRlbXBsYXRlIGlzIHN0YXJ0aW5nIHRvIGhpZGUKICAgIG9uVGVtcGxhdGVIaWRlOiBmdW5jdGlvbiBvblRlbXBsYXRlSGlkZSgpIHsKICAgICAgLy8gRGlzYWJsZSB3aGlsZSBvcGVuIGxpc3RlbmVycy93YXRjaGVycwogICAgICB0aGlzLnNldFdoaWxlT3Blbkxpc3RlbmVycyhmYWxzZSk7CiAgICB9LAogICAgLy8gV2hlbiB0ZW1wbGF0ZSBoYXMgY29tcGxldGVkIGNsb3NpbmcgKGp1c3QgYmVmb3JlIGl0IHNlbGYgZGVzdHJ1Y3RzKQogICAgb25UZW1wbGF0ZUhpZGRlbjogZnVuY3Rpb24gb25UZW1wbGF0ZUhpZGRlbigpIHsKICAgICAgLy8gRGVzdHJveSB0aGUgdGVtcGxhdGUKICAgICAgdGhpcy5kZXN0cm95VGVtcGxhdGUoKTsgLy8gRW1pdCBhIG5vbi1jYW5jZWxhYmxlIEJ2RXZlbnQgJ3Nob3duJwoKICAgICAgdGhpcy5lbWl0RXZlbnQodGhpcy5idWlsZEV2ZW50KEVWRU5UX05BTUVfSElEREVOKSk7CiAgICB9LAogICAgLy8gLS0tIEhlbHBlciBtZXRob2RzIC0tLQogICAgZ2V0VGFyZ2V0OiBmdW5jdGlvbiBnZXRUYXJnZXQoKSB7CiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLnRhcmdldDsKCiAgICAgIGlmIChpc1N0cmluZyh0YXJnZXQpKSB7CiAgICAgICAgdGFyZ2V0ID0gZ2V0QnlJZCh0YXJnZXQucmVwbGFjZSgvXiMvLCAnJykpOwogICAgICB9IGVsc2UgaWYgKGlzRnVuY3Rpb24odGFyZ2V0KSkgewogICAgICAgIHRhcmdldCA9IHRhcmdldCgpOwogICAgICB9IGVsc2UgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldCA9IHRhcmdldC4kZWwgfHwgdGFyZ2V0OwogICAgICB9CgogICAgICByZXR1cm4gaXNFbGVtZW50KHRhcmdldCkgPyB0YXJnZXQgOiBudWxsOwogICAgfSwKICAgIGdldFBsYWNlbWVudFRhcmdldDogZnVuY3Rpb24gZ2V0UGxhY2VtZW50VGFyZ2V0KCkgewogICAgICAvLyBUaGlzIGlzIHRoZSB0YXJnZXQgdGhhdCB0aGUgdG9vbHRpcCB3aWxsIGJlIHBsYWNlZCBvbiwgd2hpY2ggbWF5IG5vdAogICAgICAvLyBuZWNlc3NhcmlseSBiZSB0aGUgc2FtZSBlbGVtZW50IHRoYXQgaGFzIHRoZSB0cmlnZ2VyIGV2ZW50IGxpc3RlbmVycwogICAgICAvLyBGb3Igbm93LCB0aGlzIGlzIHRoZSBzYW1lIGFzIHRhcmdldAogICAgICAvLyBUT0RPOgogICAgICAvLyAgIEFkZCBpbiBjaGlsZCBzZWxlY3RvciBzdXBwb3J0CiAgICAgIC8vICAgQWRkIGluIHZpc2liaWxpdHkgY2hlY2tzIGZvciB0aGlzIGVsZW1lbnQKICAgICAgLy8gICBGYWxsYmFjayB0byB0YXJnZXQgaWYgbm90IGZvdW5kCiAgICAgIHJldHVybiB0aGlzLmdldFRhcmdldCgpOwogICAgfSwKICAgIGdldFRhcmdldElkOiBmdW5jdGlvbiBnZXRUYXJnZXRJZCgpIHsKICAgICAgLy8gUmV0dXJucyB0aGUgSUQgb2YgdGhlIHRyaWdnZXIgZWxlbWVudAogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoKTsKICAgICAgcmV0dXJuIHRhcmdldCAmJiB0YXJnZXQuaWQgPyB0YXJnZXQuaWQgOiBudWxsOwogICAgfSwKICAgIGdldENvbnRhaW5lcjogZnVuY3Rpb24gZ2V0Q29udGFpbmVyKCkgewogICAgICAvLyBIYW5kbGUgY2FzZSB3aGVyZSBjb250YWluZXIgbWF5IGJlIGEgY29tcG9uZW50IHJlZgogICAgICB2YXIgY29udGFpbmVyID0gdGhpcy5jb250YWluZXIgPyB0aGlzLmNvbnRhaW5lci4kZWwgfHwgdGhpcy5jb250YWluZXIgOiBmYWxzZTsKICAgICAgdmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5OwogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoKTsgLy8gSWYgd2UgYXJlIGluIGEgbW9kYWwsIHdlIGFwcGVuZCB0byB0aGUgbW9kYWwsIElmIHdlCiAgICAgIC8vIGFyZSBpbiBhIHNpZGViYXIsIHdlIGFwcGVuZCB0byB0aGUgc2lkZWJhciwgZWxzZSBhcHBlbmQKICAgICAgLy8gdG8gYm9keSwgdW5sZXNzIGEgY29udGFpbmVyIGlzIHNwZWNpZmllZAogICAgICAvLyBUT0RPOgogICAgICAvLyAgIFRlbXBsYXRlIHNob3VsZCBwZXJpb2RpY2FsbHkgY2hlY2sgdG8gc2VlIGlmIGl0IGlzIGluIGRvbQogICAgICAvLyAgIEFuZCBpZiBub3QsIHNlbGYgZGVzdHJ1Y3QgKGlmIGNvbnRhaW5lciBnb3Qgdi1pZidlZCBvdXQgb2YgRE9NKQogICAgICAvLyAgIE9yIHRoaXMgY291bGQgcG9zc2libHkgYmUgcGFydCBvZiB0aGUgdmlzaWJpbGl0eSBjaGVjawoKICAgICAgcmV0dXJuIGNvbnRhaW5lciA9PT0gZmFsc2UgPyBjbG9zZXN0KENPTlRBSU5FUl9TRUxFQ1RPUiwgdGFyZ2V0KSB8fCBib2R5IDoKICAgICAgLyppc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICBpc1N0cmluZyhjb250YWluZXIpID8KICAgICAgLyppc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICBnZXRCeUlkKGNvbnRhaW5lci5yZXBsYWNlKC9eIy8sICcnKSkgfHwgYm9keSA6CiAgICAgIC8qaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgYm9keTsKICAgIH0sCiAgICBnZXRCb3VuZGFyeTogZnVuY3Rpb24gZ2V0Qm91bmRhcnkoKSB7CiAgICAgIHJldHVybiB0aGlzLmJvdW5kYXJ5ID8gdGhpcy5ib3VuZGFyeS4kZWwgfHwgdGhpcy5ib3VuZGFyeSA6ICdzY3JvbGxQYXJlbnQnOwogICAgfSwKICAgIGlzSW5Nb2RhbDogZnVuY3Rpb24gaXNJbk1vZGFsKCkgewogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoKTsKICAgICAgcmV0dXJuIHRhcmdldCAmJiBjbG9zZXN0KE1PREFMX1NFTEVDVE9SLCB0YXJnZXQpOwogICAgfSwKICAgIGlzRHJvcGRvd246IGZ1bmN0aW9uIGlzRHJvcGRvd24oKSB7CiAgICAgIC8vIFJldHVybnMgdHJ1ZSBpZiB0cmlnZ2VyIGlzIGEgZHJvcGRvd24KICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KCk7CiAgICAgIHJldHVybiB0YXJnZXQgJiYgaGFzQ2xhc3ModGFyZ2V0LCBEUk9QRE9XTl9DTEFTUyk7CiAgICB9LAogICAgZHJvcGRvd25PcGVuOiBmdW5jdGlvbiBkcm9wZG93bk9wZW4oKSB7CiAgICAgIC8vIFJldHVybnMgdHJ1ZSBpZiB0cmlnZ2VyIGlzIGEgZHJvcGRvd24gYW5kIHRoZSBkcm9wZG93biBtZW51IGlzIG9wZW4KICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KCk7CiAgICAgIHJldHVybiB0aGlzLmlzRHJvcGRvd24oKSAmJiB0YXJnZXQgJiYgc2VsZWN0KERST1BET1dOX09QRU5fU0VMRUNUT1IsIHRhcmdldCk7CiAgICB9LAogICAgY2xlYXJIb3ZlclRpbWVvdXQ6IGZ1bmN0aW9uIGNsZWFySG92ZXJUaW1lb3V0KCkgewogICAgICBjbGVhclRpbWVvdXQodGhpcy4kX2hvdmVyVGltZW91dCk7CiAgICAgIHRoaXMuJF9ob3ZlclRpbWVvdXQgPSBudWxsOwogICAgfSwKICAgIGNsZWFyVmlzaWJpbGl0eUludGVydmFsOiBmdW5jdGlvbiBjbGVhclZpc2liaWxpdHlJbnRlcnZhbCgpIHsKICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLiRfdmlzaWJsZUludGVydmFsKTsKICAgICAgdGhpcy4kX3Zpc2libGVJbnRlcnZhbCA9IG51bGw7CiAgICB9LAogICAgY2xlYXJBY3RpdmVUcmlnZ2VyczogZnVuY3Rpb24gY2xlYXJBY3RpdmVUcmlnZ2VycygpIHsKICAgICAgZm9yICh2YXIgdHJpZ2dlciBpbiB0aGlzLmFjdGl2ZVRyaWdnZXIpIHsKICAgICAgICB0aGlzLmFjdGl2ZVRyaWdnZXJbdHJpZ2dlcl0gPSBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIGFkZEFyaWFEZXNjcmliZWRieTogZnVuY3Rpb24gYWRkQXJpYURlc2NyaWJlZGJ5KCkgewogICAgICAvLyBBZGQgYXJpYS1kZXNjcmliZWRieSBvbiB0cmlnZ2VyIGVsZW1lbnQsIHdpdGhvdXQgcmVtb3ZpbmcgYW55IG90aGVyIElEcwogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoKTsKICAgICAgdmFyIGRlc2MgPSBnZXRBdHRyKHRhcmdldCwgJ2FyaWEtZGVzY3JpYmVkYnknKSB8fCAnJzsKICAgICAgZGVzYyA9IGRlc2Muc3BsaXQoL1xzKy8pLmNvbmNhdCh0aGlzLmNvbXB1dGVkSWQpLmpvaW4oJyAnKS50cmltKCk7IC8vIFVwZGF0ZS9hZGQgYXJpYS1kZXNjcmliZWQgYnkKCiAgICAgIHNldEF0dHIodGFyZ2V0LCAnYXJpYS1kZXNjcmliZWRieScsIGRlc2MpOwogICAgfSwKICAgIHJlbW92ZUFyaWFEZXNjcmliZWRieTogZnVuY3Rpb24gcmVtb3ZlQXJpYURlc2NyaWJlZGJ5KCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsgLy8gUmVtb3ZlIGFyaWEtZGVzY3JpYmVkYnkgb24gdHJpZ2dlciBlbGVtZW50LCB3aXRob3V0IHJlbW92aW5nIGFueSBvdGhlciBJRHMKCgogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoKTsKICAgICAgdmFyIGRlc2MgPSBnZXRBdHRyKHRhcmdldCwgJ2FyaWEtZGVzY3JpYmVkYnknKSB8fCAnJzsKICAgICAgZGVzYyA9IGRlc2Muc3BsaXQoL1xzKy8pLmZpbHRlcihmdW5jdGlvbiAoZCkgewogICAgICAgIHJldHVybiBkICE9PSBfdGhpczUuY29tcHV0ZWRJZDsKICAgICAgfSkuam9pbignICcpLnRyaW0oKTsgLy8gVXBkYXRlIG9yIHJlbW92ZSBhcmlhLWRlc2NyaWJlZGJ5CgogICAgICBpZiAoZGVzYykgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgc2V0QXR0cih0YXJnZXQsICdhcmlhLWRlc2NyaWJlZGJ5JywgZGVzYyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmVtb3ZlQXR0cih0YXJnZXQsICdhcmlhLWRlc2NyaWJlZGJ5Jyk7CiAgICAgIH0KICAgIH0sCiAgICBmaXhUaXRsZTogZnVuY3Rpb24gZml4VGl0bGUoKSB7CiAgICAgIC8vIElmIHRoZSB0YXJnZXQgaGFzIGEgYHRpdGxlYCBhdHRyaWJ1dGUsCiAgICAgIC8vIHJlbW92ZSBpdCBhbmQgc3RvcmUgaXQgb24gYSBkYXRhIGF0dHJpYnV0ZQogICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5nZXRUYXJnZXQoKTsKCiAgICAgIGlmIChoYXNBdHRyKHRhcmdldCwgJ3RpdGxlJykpIHsKICAgICAgICAvLyBHZXQgYHRpdGxlYCBhdHRyaWJ1dGUgdmFsdWUgYW5kIHJlbW92ZSBpdCBmcm9tIHRhcmdldAogICAgICAgIHZhciB0aXRsZSA9IGdldEF0dHIodGFyZ2V0LCAndGl0bGUnKTsKICAgICAgICBzZXRBdHRyKHRhcmdldCwgJ3RpdGxlJywgJycpOyAvLyBPbmx5IHNldCB0aGUgZGF0YSBhdHRyaWJ1dGUgd2hlbiB0aGUgdmFsdWUgaXMgdHJ1dGh5CgogICAgICAgIGlmICh0aXRsZSkgewogICAgICAgICAgc2V0QXR0cih0YXJnZXQsIERBVEFfVElUTEVfQVRUUiwgdGl0bGUpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHJlc3RvcmVUaXRsZTogZnVuY3Rpb24gcmVzdG9yZVRpdGxlKCkgewogICAgICAvLyBJZiB0aGUgdGFyZ2V0IGhhZCBhIGB0aXRsZWAgYXR0cmlidXRlLAogICAgICAvLyByZXN0b3JlIGl0IGFuZCByZW1vdmUgdGhlIGRhdGEgYXR0cmlidXRlCiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmdldFRhcmdldCgpOwoKICAgICAgaWYgKGhhc0F0dHIodGFyZ2V0LCBEQVRBX1RJVExFX0FUVFIpKSB7CiAgICAgICAgLy8gR2V0IGRhdGEgYXR0cmlidXRlIHZhbHVlIGFuZCByZW1vdmUgaXQgZnJvbSB0YXJnZXQKICAgICAgICB2YXIgdGl0bGUgPSBnZXRBdHRyKHRhcmdldCwgREFUQV9USVRMRV9BVFRSKTsKICAgICAgICByZW1vdmVBdHRyKHRhcmdldCwgREFUQV9USVRMRV9BVFRSKTsgLy8gT25seSByZXN0b3JlIHRoZSBgdGl0bGVgIGF0dHJpYnV0ZSB3aGVuIHRoZSB2YWx1ZSBpcyB0cnV0aHkKCiAgICAgICAgaWYgKHRpdGxlKSB7CiAgICAgICAgICBzZXRBdHRyKHRhcmdldCwgJ3RpdGxlJywgdGl0bGUpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vIC0tLSBCdkV2ZW50IGhlbHBlcnMgLS0tCiAgICBidWlsZEV2ZW50OiBmdW5jdGlvbiBidWlsZEV2ZW50KHR5cGUpIHsKICAgICAgdmFyIG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OyAvLyBEZWZhdWx0cyB0byBhIG5vbi1jYW5jZWxsYWJsZSBldmVudAoKICAgICAgcmV0dXJuIG5ldyBCdkV2ZW50KHR5cGUsIF9vYmplY3RTcHJlYWQoewogICAgICAgIGNhbmNlbGFibGU6IGZhbHNlLAogICAgICAgIHRhcmdldDogdGhpcy5nZXRUYXJnZXQoKSwKICAgICAgICByZWxhdGVkVGFyZ2V0OiB0aGlzLmdldFRlbXBsYXRlRWxlbWVudCgpIHx8IG51bGwsCiAgICAgICAgY29tcG9uZW50SWQ6IHRoaXMuY29tcHV0ZWRJZCwKICAgICAgICB2dWVUYXJnZXQ6IHRoaXMKICAgICAgfSwgb3B0aW9ucykpOwogICAgfSwKICAgIGVtaXRFdmVudDogZnVuY3Rpb24gZW1pdEV2ZW50KGJ2RXZlbnQpIHsKICAgICAgdmFyIHR5cGUgPSBidkV2ZW50LnR5cGU7CiAgICAgIHRoaXMuZW1pdE9uUm9vdChnZXRSb290RXZlbnROYW1lKHRoaXMudGVtcGxhdGVUeXBlLCB0eXBlKSwgYnZFdmVudCk7CiAgICAgIHRoaXMuJGVtaXQodHlwZSwgYnZFdmVudCk7CiAgICB9LAogICAgLy8gLS0tIEV2ZW50IGhhbmRsZXIgc2V0dXAgbWV0aG9kcyAtLS0KICAgIGxpc3RlbjogZnVuY3Rpb24gbGlzdGVuKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsgLy8gRW5hYmxlIHRyaWdnZXIgZXZlbnQgaGFuZGxlcnMKCgogICAgICB2YXIgZWwgPSB0aGlzLmdldFRhcmdldCgpOwoKICAgICAgaWYgKCFlbCkgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIExpc3RlbiBmb3IgZ2xvYmFsIHNob3cvaGlkZSBldmVudHMKCgogICAgICB0aGlzLnNldFJvb3RMaXN0ZW5lcih0cnVlKTsgLy8gU2V0IHVwIG91ciBsaXN0ZW5lcnMgb24gdGhlIHRhcmdldCB0cmlnZ2VyIGVsZW1lbnQKCiAgICAgIHRoaXMuY29tcHV0ZWRUcmlnZ2Vycy5mb3JFYWNoKGZ1bmN0aW9uICh0cmlnZ2VyKSB7CiAgICAgICAgaWYgKHRyaWdnZXIgPT09ICdjbGljaycpIHsKICAgICAgICAgIGV2ZW50T24oZWwsICdjbGljaycsIF90aGlzNi5oYW5kbGVFdmVudCwgRVZFTlRfT1BUSU9OU19OT19DQVBUVVJFKTsKICAgICAgICB9IGVsc2UgaWYgKHRyaWdnZXIgPT09ICdmb2N1cycpIHsKICAgICAgICAgIGV2ZW50T24oZWwsICdmb2N1c2luJywgX3RoaXM2LmhhbmRsZUV2ZW50LCBFVkVOVF9PUFRJT05TX05PX0NBUFRVUkUpOwogICAgICAgICAgZXZlbnRPbihlbCwgJ2ZvY3Vzb3V0JywgX3RoaXM2LmhhbmRsZUV2ZW50LCBFVkVOVF9PUFRJT05TX05PX0NBUFRVUkUpOwogICAgICAgIH0gZWxzZSBpZiAodHJpZ2dlciA9PT0gJ2JsdXInKSB7CiAgICAgICAgICAvLyBVc2VkIHRvIGNsb3NlICR0aXAgd2hlbiBlbGVtZW50IGxvb3NlcyBmb2N1cwoKICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgICBldmVudE9uKGVsLCAnZm9jdXNvdXQnLCBfdGhpczYuaGFuZGxlRXZlbnQsIEVWRU5UX09QVElPTlNfTk9fQ0FQVFVSRSk7CiAgICAgICAgfSBlbHNlIGlmICh0cmlnZ2VyID09PSAnaG92ZXInKSB7CiAgICAgICAgICBldmVudE9uKGVsLCAnbW91c2VlbnRlcicsIF90aGlzNi5oYW5kbGVFdmVudCwgRVZFTlRfT1BUSU9OU19OT19DQVBUVVJFKTsKICAgICAgICAgIGV2ZW50T24oZWwsICdtb3VzZWxlYXZlJywgX3RoaXM2LmhhbmRsZUV2ZW50LCBFVkVOVF9PUFRJT05TX05PX0NBUFRVUkUpOwogICAgICAgIH0KICAgICAgfSwgdGhpcyk7CiAgICB9LAoKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICB1bkxpc3RlbjogZnVuY3Rpb24gdW5MaXN0ZW4oKSB7CiAgICAgIHZhciBfdGhpczcgPSB0aGlzOyAvLyBSZW1vdmUgdHJpZ2dlciBldmVudCBoYW5kbGVycwoKCiAgICAgIHZhciBldmVudHMgPSBbJ2NsaWNrJywgJ2ZvY3VzaW4nLCAnZm9jdXNvdXQnLCAnbW91c2VlbnRlcicsICdtb3VzZWxlYXZlJ107CiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmdldFRhcmdldCgpOyAvLyBTdG9wIGxpc3RlbmluZyBmb3IgZ2xvYmFsIHNob3cvaGlkZS9lbmFibGUvZGlzYWJsZSBldmVudHMKCiAgICAgIHRoaXMuc2V0Um9vdExpc3RlbmVyKGZhbHNlKTsgLy8gQ2xlYXIgb3V0IGFueSBhY3RpdmUgdGFyZ2V0IGxpc3RlbmVycwoKICAgICAgZXZlbnRzLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgdGFyZ2V0ICYmIGV2ZW50T2ZmKHRhcmdldCwgZXZlbnQsIF90aGlzNy5oYW5kbGVFdmVudCwgRVZFTlRfT1BUSU9OU19OT19DQVBUVVJFKTsKICAgICAgfSwgdGhpcyk7CiAgICB9LAogICAgc2V0Um9vdExpc3RlbmVyOiBmdW5jdGlvbiBzZXRSb290TGlzdGVuZXIob24pIHsKICAgICAgLy8gTGlzdGVuIGZvciBnbG9iYWwgYGJ2Ojp7aGlkZXxzaG93fTo6e3Rvb2x0aXB8cG9wb3Zlcn1gIGhpZGUgcmVxdWVzdCBldmVudAogICAgICB2YXIgJHJvb3QgPSB0aGlzLiRyb290OwoKICAgICAgaWYgKCRyb290KSB7CiAgICAgICAgdmFyIG1ldGhvZCA9IG9uID8gJyRvbicgOiAnJG9mZic7CiAgICAgICAgdmFyIHR5cGUgPSB0aGlzLnRlbXBsYXRlVHlwZTsKICAgICAgICAkcm9vdFttZXRob2RdKGdldFJvb3RBY3Rpb25FdmVudE5hbWUodHlwZSwgRVZFTlRfTkFNRV9ISURFKSwgdGhpcy5kb0hpZGUpOwogICAgICAgICRyb290W21ldGhvZF0oZ2V0Um9vdEFjdGlvbkV2ZW50TmFtZSh0eXBlLCBFVkVOVF9OQU1FX1NIT1cpLCB0aGlzLmRvU2hvdyk7CiAgICAgICAgJHJvb3RbbWV0aG9kXShnZXRSb290QWN0aW9uRXZlbnROYW1lKHR5cGUsIEVWRU5UX05BTUVfRElTQUJMRSksIHRoaXMuZG9EaXNhYmxlKTsKICAgICAgICAkcm9vdFttZXRob2RdKGdldFJvb3RBY3Rpb25FdmVudE5hbWUodHlwZSwgRVZFTlRfTkFNRV9FTkFCTEUpLCB0aGlzLmRvRW5hYmxlKTsKICAgICAgfQogICAgfSwKICAgIHNldFdoaWxlT3Blbkxpc3RlbmVyczogZnVuY3Rpb24gc2V0V2hpbGVPcGVuTGlzdGVuZXJzKG9uKSB7CiAgICAgIC8vIEV2ZW50cyB0aGF0IGFyZSBvbmx5IHJlZ2lzdGVyZWQgd2hlbiB0aGUgdGVtcGxhdGUgaXMgc2hvd2luZwogICAgICAvLyBNb2RhbCBjbG9zZSBldmVudHMKICAgICAgdGhpcy5zZXRNb2RhbExpc3RlbmVyKG9uKTsgLy8gRHJvcGRvd24gb3BlbiBldmVudHMgKGlmIHdlIGFyZSBhdHRhY2hlZCB0byBhIGRyb3Bkb3duKQoKICAgICAgdGhpcy5zZXREcm9wZG93bkxpc3RlbmVyKG9uKTsgLy8gUGVyaW9kaWMgJGVsZW1lbnQgdmlzaWJpbGl0eSBjaGVjawogICAgICAvLyBGb3IgaGFuZGxpbmcgd2hlbiB0aXAgdGFyZ2V0IGlzIGluIDxrZWVwYWxpdmU+LCB0YWJzLCBjYXJvdXNlbCwgZXRjCgogICAgICB0aGlzLnZpc2libGVDaGVjayhvbik7IC8vIE9uLXRvdWNoIHN0YXJ0IGxpc3RlbmVycwoKICAgICAgdGhpcy5zZXRPblRvdWNoU3RhcnRMaXN0ZW5lcihvbik7CiAgICB9LAogICAgLy8gSGFuZGxlciBmb3IgcGVyaW9kaWMgdmlzaWJpbGl0eSBjaGVjawogICAgdmlzaWJsZUNoZWNrOiBmdW5jdGlvbiB2aXNpYmxlQ2hlY2sob24pIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICB0aGlzLmNsZWFyVmlzaWJpbGl0eUludGVydmFsKCk7CiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmdldFRhcmdldCgpOwogICAgICB2YXIgdGlwID0gdGhpcy5nZXRUZW1wbGF0ZUVsZW1lbnQoKTsKCiAgICAgIGlmIChvbikgewogICAgICAgIHRoaXMuJF92aXNpYmxlSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7CiAgICAgICAgICBpZiAodGlwICYmIF90aGlzOC5sb2NhbFNob3cgJiYgKCF0YXJnZXQucGFyZW50Tm9kZSB8fCAhaXNWaXNpYmxlKHRhcmdldCkpKSB7CiAgICAgICAgICAgIC8vIFRhcmdldCBlbGVtZW50IGlzIG5vIGxvbmdlciB2aXNpYmxlIG9yIG5vdCBpbiBET00sIHNvIGZvcmNlLWhpZGUgdGhlIHRvb2x0aXAKICAgICAgICAgICAgX3RoaXM4LmZvcmNlSGlkZSgpOwogICAgICAgICAgfQogICAgICAgIH0sIDEwMCk7CiAgICAgIH0KICAgIH0sCiAgICBzZXRNb2RhbExpc3RlbmVyOiBmdW5jdGlvbiBzZXRNb2RhbExpc3RlbmVyKG9uKSB7CiAgICAgIC8vIEhhbmRsZSBjYXNlIHdoZXJlIHRvb2x0aXAvdGFyZ2V0IGlzIGluIGEgbW9kYWwKICAgICAgaWYgKHRoaXMuaXNJbk1vZGFsKCkpIHsKICAgICAgICAvLyBXZSBjYW4gbGlzdGVuIGZvciBtb2RhbCBoaWRkZW4gZXZlbnRzIG9uIGAkcm9vdGAKICAgICAgICB0aGlzLiRyb290W29uID8gJyRvbicgOiAnJG9mZiddKFJPT1RfRVZFTlRfTkFNRV9NT0RBTF9ISURERU4sIHRoaXMuZm9yY2VIaWRlKTsKICAgICAgfQogICAgfSwKCiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dDogSlNET00gZG9lc24ndCBzdXBwb3J0IGBvbnRvdWNoc3RhcnRgICovCiAgICBzZXRPblRvdWNoU3RhcnRMaXN0ZW5lcjogZnVuY3Rpb24gc2V0T25Ub3VjaFN0YXJ0TGlzdGVuZXIob24pIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7IC8vIElmIHRoaXMgaXMgYSB0b3VjaC1lbmFibGVkIGRldmljZSB3ZSBhZGQgZXh0cmEgZW1wdHkKICAgICAgLy8gYG1vdXNlb3ZlcmAgbGlzdGVuZXJzIHRvIHRoZSBib2R5J3MgaW1tZWRpYXRlIGNoaWxkcmVuCiAgICAgIC8vIE9ubHkgbmVlZGVkIGJlY2F1c2Ugb2YgYnJva2VuIGV2ZW50IGRlbGVnYXRpb24gb24gaU9TCiAgICAgIC8vIGh0dHBzOi8vd3d3LnF1aXJrc21vZGUub3JnL2Jsb2cvYXJjaGl2ZXMvMjAxNC8wMi9tb3VzZV9ldmVudF9idWIuaHRtbAoKCiAgICAgIGlmICgnb250b3VjaHN0YXJ0JyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpIHsKICAgICAgICBhcnJheUZyb20oZG9jdW1lbnQuYm9keS5jaGlsZHJlbikuZm9yRWFjaChmdW5jdGlvbiAoZWwpIHsKICAgICAgICAgIGV2ZW50T25PZmYob24sIGVsLCAnbW91c2VvdmVyJywgX3RoaXM5LiRfbm9vcCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzZXREcm9wZG93bkxpc3RlbmVyOiBmdW5jdGlvbiBzZXREcm9wZG93bkxpc3RlbmVyKG9uKSB7CiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmdldFRhcmdldCgpOwoKICAgICAgaWYgKCF0YXJnZXQgfHwgIXRoaXMuJHJvb3QgfHwgIXRoaXMuaXNEcm9wZG93bikgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBXZSBjYW4gbGlzdGVuIGZvciBkcm9wZG93biBzaG93biBldmVudHMgb24gaXRzIGluc3RhbmNlCiAgICAgIC8vIFRPRE86CiAgICAgIC8vICAgV2UgY291bGQgZ3JhYiB0aGUgSUQgZnJvbSB0aGUgZHJvcGRvd24sIGFuZCBsaXN0ZW4gZm9yCiAgICAgIC8vICAgJHJvb3QgZXZlbnRzIGZvciB0aGF0IHBhcnRpY3VsYXIgZHJvcGRvd24gaWQKICAgICAgLy8gICBEcm9wZG93biBzaG93biBhbmQgaGlkZGVuIGV2ZW50cyB3aWxsIG5lZWQgdG8gZW1pdAogICAgICAvLyAgIE5vdGU6IERyb3Bkb3duIGF1dG8tSUQgaGFwcGVucyBpbiBhIGAkbmV4dFRpY2soKWAgYWZ0ZXIgbW91bnQKICAgICAgLy8gICAgICAgICBTbyB0aGUgSUQgbG9va3VwIHdvdWxkIG5lZWQgdG8gYmUgZG9uZSBpbiBhIGAkbmV4dFRpY2soKWAKCgogICAgICBpZiAodGFyZ2V0Ll9fdnVlX18pIHsKICAgICAgICB0YXJnZXQuX192dWVfX1tvbiA/ICckb24nIDogJyRvZmYnXShFVkVOVF9OQU1FX1NIT1dOLCB0aGlzLmZvcmNlSGlkZSk7CiAgICAgIH0KICAgIH0sCiAgICAvLyAtLS0gRXZlbnQgaGFuZGxlcnMgLS0tCiAgICBoYW5kbGVFdmVudDogZnVuY3Rpb24gaGFuZGxlRXZlbnQoZXZlbnQpIHsKICAgICAgLy8gR2VuZXJhbCB0cmlnZ2VyIGV2ZW50IGhhbmRsZXIKICAgICAgLy8gdGFyZ2V0IGlzIHRoZSB0cmlnZ2VyIGVsZW1lbnQKICAgICAgdmFyIHRhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KCk7CgogICAgICBpZiAoIXRhcmdldCB8fCBpc0Rpc2FibGVkKHRhcmdldCkgfHwgIXRoaXMuJF9lbmFibGVkIHx8IHRoaXMuZHJvcGRvd25PcGVuKCkpIHsKICAgICAgICAvLyBJZiBkaXNhYmxlZCBvciBub3QgZW5hYmxlZCwgb3IgaWYgYSBkcm9wZG93biB0aGF0IGlzIG9wZW4sIGRvbid0IGRvIGFueXRoaW5nCiAgICAgICAgLy8gSWYgdGlwIGlzIHNob3duIGJlZm9yZSBlbGVtZW50IGdldHMgZGlzYWJsZWQsIHRoZW4gdGlwIHdpbGwgbm90CiAgICAgICAgLy8gY2xvc2UgdW50aWwgbm8gbG9uZ2VyIGRpc2FibGVkIG9yIGZvcmNlZnVsbHkgY2xvc2VkCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdHlwZSA9IGV2ZW50LnR5cGU7CiAgICAgIHZhciB0cmlnZ2VycyA9IHRoaXMuY29tcHV0ZWRUcmlnZ2VyczsKCiAgICAgIGlmICh0eXBlID09PSAnY2xpY2snICYmIGFycmF5SW5jbHVkZXModHJpZ2dlcnMsICdjbGljaycpKSB7CiAgICAgICAgdGhpcy5jbGljayhldmVudCk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ21vdXNlZW50ZXInICYmIGFycmF5SW5jbHVkZXModHJpZ2dlcnMsICdob3ZlcicpKSB7CiAgICAgICAgLy8gYG1vdXNlZW50ZXJgIGlzIGEgbm9uLWJ1YmJsaW5nIGV2ZW50CiAgICAgICAgdGhpcy5lbnRlcihldmVudCk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2ZvY3VzaW4nICYmIGFycmF5SW5jbHVkZXModHJpZ2dlcnMsICdmb2N1cycpKSB7CiAgICAgICAgLy8gYGZvY3VzaW5gIGlzIGEgYnViYmxpbmcgZXZlbnQKICAgICAgICAvLyBgZXZlbnRgIGluY2x1ZGVzIGByZWxhdGVkVGFyZ2V0YCAoZWxlbWVudCBsb3NpbmcgZm9jdXMpCiAgICAgICAgdGhpcy5lbnRlcihldmVudCk7CiAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2ZvY3Vzb3V0JyAmJiAoYXJyYXlJbmNsdWRlcyh0cmlnZ2VycywgJ2ZvY3VzJykgfHwgYXJyYXlJbmNsdWRlcyh0cmlnZ2VycywgJ2JsdXInKSkgfHwgdHlwZSA9PT0gJ21vdXNlbGVhdmUnICYmIGFycmF5SW5jbHVkZXModHJpZ2dlcnMsICdob3ZlcicpKSB7CiAgICAgICAgLy8gYGZvY3Vzb3V0YCBpcyBhIGJ1YmJsaW5nIGV2ZW50CiAgICAgICAgLy8gYG1vdXNlbGVhdmVgIGlzIGEgbm9uLWJ1YmJsaW5nIGV2ZW50CiAgICAgICAgLy8gYHRpcGAgaXMgdGhlIHRlbXBsYXRlICh3aWxsIGJlIG51bGwgaWYgbm90IG9wZW4pCiAgICAgICAgdmFyIHRpcCA9IHRoaXMuZ2V0VGVtcGxhdGVFbGVtZW50KCk7IC8vIGBldmVudFRhcmdldGAgaXMgdGhlIGVsZW1lbnQgd2hpY2ggaXMgbG9zaW5nIGZvY3VzL2hvdmVyIGFuZAoKICAgICAgICB2YXIgZXZlbnRUYXJnZXQgPSBldmVudC50YXJnZXQ7IC8vIGByZWxhdGVkVGFyZ2V0YCBpcyB0aGUgZWxlbWVudCBnYWluaW5nIGZvY3VzL2hvdmVyCgogICAgICAgIHZhciByZWxhdGVkVGFyZ2V0ID0gZXZlbnQucmVsYXRlZFRhcmdldDsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoKICAgICAgICBpZiAoIC8vIEZyb20gdGlwIHRvIHRhcmdldAogICAgICAgIHRpcCAmJiBjb250YWlucyh0aXAsIGV2ZW50VGFyZ2V0KSAmJiBjb250YWlucyh0YXJnZXQsIHJlbGF0ZWRUYXJnZXQpIHx8IC8vIEZyb20gdGFyZ2V0IHRvIHRpcAogICAgICAgIHRpcCAmJiBjb250YWlucyh0YXJnZXQsIGV2ZW50VGFyZ2V0KSAmJiBjb250YWlucyh0aXAsIHJlbGF0ZWRUYXJnZXQpIHx8IC8vIFdpdGhpbiB0aXAKICAgICAgICB0aXAgJiYgY29udGFpbnModGlwLCBldmVudFRhcmdldCkgJiYgY29udGFpbnModGlwLCByZWxhdGVkVGFyZ2V0KSB8fCAvLyBXaXRoaW4gdGFyZ2V0CiAgICAgICAgY29udGFpbnModGFyZ2V0LCBldmVudFRhcmdldCkgJiYgY29udGFpbnModGFyZ2V0LCByZWxhdGVkVGFyZ2V0KSkgewogICAgICAgICAgLy8gSWYgZm9jdXMvaG92ZXIgbW92ZXMgd2l0aGluIGB0aXBgIGFuZCBgdGFyZ2V0YCwgZG9uJ3QgdHJpZ2dlciBhIGxlYXZlCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSAvLyBPdGhlcndpc2UgdHJpZ2dlciBhIGxlYXZlCgoKICAgICAgICB0aGlzLmxlYXZlKGV2ZW50KTsKICAgICAgfQogICAgfSwKICAgIGRvSGlkZTogZnVuY3Rpb24gZG9IaWRlKGlkKSB7CiAgICAgIC8vIFByb2dyYW1tYXRpY2FsbHkgaGlkZSB0b29sdGlwIG9yIHBvcG92ZXIKICAgICAgaWYgKCFpZCB8fCB0aGlzLmdldFRhcmdldElkKCkgPT09IGlkIHx8IHRoaXMuY29tcHV0ZWRJZCA9PT0gaWQpIHsKICAgICAgICAvLyBDbG9zZSBhbGwgdG9vbHRpcHMgb3IgcG9wb3ZlcnMsIG9yIHRoaXMgc3BlY2lmaWMgdGlwICh3aXRoIElEKQogICAgICAgIHRoaXMuZm9yY2VIaWRlKCk7CiAgICAgIH0KICAgIH0sCiAgICBkb1Nob3c6IGZ1bmN0aW9uIGRvU2hvdyhpZCkgewogICAgICAvLyBQcm9ncmFtbWF0aWNhbGx5IHNob3cgdG9vbHRpcCBvciBwb3BvdmVyCiAgICAgIGlmICghaWQgfHwgdGhpcy5nZXRUYXJnZXRJZCgpID09PSBpZCB8fCB0aGlzLmNvbXB1dGVkSWQgPT09IGlkKSB7CiAgICAgICAgLy8gT3BlbiBhbGwgdG9vbHRpcHMgb3IgcG9wb3ZlcnMsIG9yIHRoaXMgc3BlY2lmaWMgdGlwICh3aXRoIElEKQogICAgICAgIHRoaXMuc2hvdygpOwogICAgICB9CiAgICB9LAoKICAgIC8qaXN0YW5idWwgaWdub3JlIG5leHQ6IGlnbm9yZSBmb3Igbm93ICovCiAgICBkb0Rpc2FibGU6IGZ1bmN0aW9uIGRvRGlzYWJsZShpZCkKICAgIC8qaXN0YW5idWwgaWdub3JlIG5leHQ6IGlnbm9yZSBmb3Igbm93ICovCiAgICB7CiAgICAgIC8vIFByb2dyYW1tYXRpY2FsbHkgZGlzYWJsZSB0b29sdGlwIG9yIHBvcG92ZXIKICAgICAgaWYgKCFpZCB8fCB0aGlzLmdldFRhcmdldElkKCkgPT09IGlkIHx8IHRoaXMuY29tcHV0ZWRJZCA9PT0gaWQpIHsKICAgICAgICAvLyBEaXNhYmxlIGFsbCB0b29sdGlwcyBvciBwb3BvdmVycyAobm8gSUQpLCBvciB0aGlzIHNwZWNpZmljIHRpcCAod2l0aCBJRCkKICAgICAgICB0aGlzLmRpc2FibGUoKTsKICAgICAgfQogICAgfSwKCiAgICAvKmlzdGFuYnVsIGlnbm9yZSBuZXh0OiBpZ25vcmUgZm9yIG5vdyAqLwogICAgZG9FbmFibGU6IGZ1bmN0aW9uIGRvRW5hYmxlKGlkKQogICAgLyppc3RhbmJ1bCBpZ25vcmUgbmV4dDogaWdub3JlIGZvciBub3cgKi8KICAgIHsKICAgICAgLy8gUHJvZ3JhbW1hdGljYWxseSBlbmFibGUgdG9vbHRpcCBvciBwb3BvdmVyCiAgICAgIGlmICghaWQgfHwgdGhpcy5nZXRUYXJnZXRJZCgpID09PSBpZCB8fCB0aGlzLmNvbXB1dGVkSWQgPT09IGlkKSB7CiAgICAgICAgLy8gRW5hYmxlIGFsbCB0b29sdGlwcyBvciBwb3BvdmVycyAobm8gSUQpLCBvciB0aGlzIHNwZWNpZmljIHRpcCAod2l0aCBJRCkKICAgICAgICB0aGlzLmVuYWJsZSgpOwogICAgICB9CiAgICB9LAogICAgY2xpY2s6IGZ1bmN0aW9uIGNsaWNrKGV2ZW50KSB7CiAgICAgIGlmICghdGhpcy4kX2VuYWJsZWQgfHwgdGhpcy5kcm9wZG93bk9wZW4oKSkgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIEdldCBhcm91bmQgYSBXZWJLaXQgYnVnIHdoZXJlIGBjbGlja2AgZG9lcyBub3QgdHJpZ2dlciBmb2N1cyBldmVudHMKICAgICAgLy8gT24gbW9zdCBicm93c2VycywgYGNsaWNrYCB0cmlnZ2VycyBhIGBmb2N1c2luYC9gZm9jdXNgIGV2ZW50IGZpcnN0CiAgICAgIC8vIE5lZWRlZCBzbyB0aGF0IHRyaWdnZXIgJ2NsaWNrIGJsdXInIHdvcmtzIG9uIGlPUwogICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYm9vdHN0cmFwLXZ1ZS9ib290c3RyYXAtdnVlL2lzc3Vlcy81MDk5CiAgICAgIC8vIFdlIHVzZSBgY3VycmVudFRhcmdldGAgcmF0aGVyIHRoYW4gYHRhcmdldGAgdG8gdHJpZ2dlciBvbiB0aGUKICAgICAgLy8gZWxlbWVudCwgbm90IHRoZSBpbm5lciBjb250ZW50CgoKICAgICAgYXR0ZW1wdEZvY3VzKGV2ZW50LmN1cnJlbnRUYXJnZXQpOwogICAgICB0aGlzLmFjdGl2ZVRyaWdnZXIuY2xpY2sgPSAhdGhpcy5hY3RpdmVUcmlnZ2VyLmNsaWNrOwoKICAgICAgaWYgKHRoaXMuaXNXaXRoQWN0aXZlVHJpZ2dlcikgewogICAgICAgIHRoaXMuZW50ZXIobnVsbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICB0aGlzLmxlYXZlKG51bGwpOwogICAgICB9CiAgICB9LAoKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICB0b2dnbGU6IGZ1bmN0aW9uIHRvZ2dsZSgpIHsKICAgICAgLy8gTWFudWFsIHRvZ2dsZSBoYW5kbGVyCiAgICAgIGlmICghdGhpcy4kX2VuYWJsZWQgfHwgdGhpcy5kcm9wZG93bk9wZW4oKSkgewogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIFNob3VsZCB3ZSByZWdpc3RlciBhcyBhbiBhY3RpdmUgdHJpZ2dlcj8KICAgICAgLy8gdGhpcy5hY3RpdmVUcmlnZ2VyLm1hbnVhbCA9ICF0aGlzLmFjdGl2ZVRyaWdnZXIubWFudWFsCgoKICAgICAgaWYgKHRoaXMubG9jYWxTaG93KSB7CiAgICAgICAgdGhpcy5sZWF2ZShudWxsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVudGVyKG51bGwpOwogICAgICB9CiAgICB9LAogICAgZW50ZXI6IGZ1bmN0aW9uIGVudGVyKCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICB2YXIgZXZlbnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IG51bGw7IC8vIE9wZW5pbmcgdHJpZ2dlciBoYW5kbGVyCiAgICAgIC8vIE5vdGU6IENsaWNrIGV2ZW50cyBhcmUgc2VudCB3aXRoIGV2ZW50ID09PSBudWxsCgogICAgICBpZiAoZXZlbnQpIHsKICAgICAgICB0aGlzLmFjdGl2ZVRyaWdnZXJbZXZlbnQudHlwZSA9PT0gJ2ZvY3VzaW4nID8gJ2ZvY3VzJyA6ICdob3ZlciddID0gdHJ1ZTsKICAgICAgfQogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoKCiAgICAgIGlmICh0aGlzLmxvY2FsU2hvdyB8fCB0aGlzLiRfaG92ZXJTdGF0ZSA9PT0gJ2luJykgewogICAgICAgIHRoaXMuJF9ob3ZlclN0YXRlID0gJ2luJzsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuY2xlYXJIb3ZlclRpbWVvdXQoKTsKICAgICAgdGhpcy4kX2hvdmVyU3RhdGUgPSAnaW4nOwoKICAgICAgaWYgKCF0aGlzLmNvbXB1dGVkRGVsYXkuc2hvdykgewogICAgICAgIHRoaXMuc2hvdygpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIEhpZGUgYW55IHRpdGxlIGF0dHJpYnV0ZSB3aGlsZSBlbnRlciBkZWxheSBpcyBhY3RpdmUKICAgICAgICB0aGlzLmZpeFRpdGxlKCk7CiAgICAgICAgdGhpcy4kX2hvdmVyVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KICAgICAgICAgIGlmIChfdGhpczEwLiRfaG92ZXJTdGF0ZSA9PT0gJ2luJykgewogICAgICAgICAgICBfdGhpczEwLnNob3coKTsKICAgICAgICAgIH0gZWxzZSBpZiAoIV90aGlzMTAubG9jYWxTaG93KSB7CiAgICAgICAgICAgIF90aGlzMTAucmVzdG9yZVRpdGxlKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgdGhpcy5jb21wdXRlZERlbGF5LnNob3cpOwogICAgICB9CiAgICB9LAogICAgbGVhdmU6IGZ1bmN0aW9uIGxlYXZlKCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICB2YXIgZXZlbnQgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IG51bGw7IC8vIENsb3NpbmcgdHJpZ2dlciBoYW5kbGVyCiAgICAgIC8vIE5vdGU6IENsaWNrIGV2ZW50cyBhcmUgc2VudCB3aXRoIGV2ZW50ID09PSBudWxsCgogICAgICBpZiAoZXZlbnQpIHsKICAgICAgICB0aGlzLmFjdGl2ZVRyaWdnZXJbZXZlbnQudHlwZSA9PT0gJ2ZvY3Vzb3V0JyA/ICdmb2N1cycgOiAnaG92ZXInXSA9IGZhbHNlOwogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgogICAgICAgIGlmIChldmVudC50eXBlID09PSAnZm9jdXNvdXQnICYmIGFycmF5SW5jbHVkZXModGhpcy5jb21wdXRlZFRyaWdnZXJzLCAnYmx1cicpKSB7CiAgICAgICAgICAvLyBTcGVjaWFsIGNhc2UgZm9yIGBibHVyYDogd2UgY2xlYXIgb3V0IHRoZSBvdGhlciB0cmlnZ2VycwogICAgICAgICAgdGhpcy5hY3RpdmVUcmlnZ2VyLmNsaWNrID0gZmFsc2U7CiAgICAgICAgICB0aGlzLmFjdGl2ZVRyaWdnZXIuaG92ZXIgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQ6IGlnbm9yZSBmb3Igbm93ICovCgoKICAgICAgaWYgKHRoaXMuaXNXaXRoQWN0aXZlVHJpZ2dlcikgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckhvdmVyVGltZW91dCgpOwogICAgICB0aGlzLiRfaG92ZXJTdGF0ZSA9ICdvdXQnOwoKICAgICAgaWYgKCF0aGlzLmNvbXB1dGVkRGVsYXkuaGlkZSkgewogICAgICAgIHRoaXMuaGlkZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJF9ob3ZlclRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGlmIChfdGhpczExLiRfaG92ZXJTdGF0ZSA9PT0gJ291dCcpIHsKICAgICAgICAgICAgX3RoaXMxMS5oaWRlKCk7CiAgICAgICAgICB9CiAgICAgICAgfSwgdGhpcy5jb21wdXRlZERlbGF5LmhpZGUpOwogICAgICB9CiAgICB9CiAgfQp9KTs="},null]}