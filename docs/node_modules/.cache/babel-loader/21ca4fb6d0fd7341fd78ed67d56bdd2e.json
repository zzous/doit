{"remainingRequest":"/Users/zzou/Downloads/backup_sample/node_modules/thread-loader/dist/cjs.js!/Users/zzou/Downloads/backup_sample/node_modules/babel-loader/lib/index.js!/Users/zzou/Downloads/backup_sample/node_modules/bootstrap-vue/esm/components/modal/modal.js","dependencies":[{"path":"/Users/zzou/Downloads/backup_sample/node_modules/bootstrap-vue/esm/components/modal/modal.js","mtime":1610263603568},{"path":"/Users/zzou/Downloads/backup_sample/node_modules/cache-loader/dist/cjs.js","mtime":1582363961748},{"path":"/Users/zzou/Downloads/backup_sample/node_modules/thread-loader/dist/cjs.js","mtime":1582363962038},{"path":"/Users/zzou/Downloads/backup_sample/node_modules/babel-loader/lib/index.js","mtime":1585275399303}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24uYmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydGllcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5kZWZpbmUtcHJvcGVydHkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CgpmdW5jdGlvbiBvd25LZXlzKG9iamVjdCwgZW51bWVyYWJsZU9ubHkpIHsKICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7CgogIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7CiAgICB2YXIgc3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMob2JqZWN0KTsKICAgIGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsKICAgICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7CiAgICB9KTsKICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBzeW1ib2xzKTsKICB9CgogIHJldHVybiBrZXlzOwp9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgewogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsKCiAgICBpZiAoaSAlIDIpIHsKICAgICAgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgewogICAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOwogICAgfSBlbHNlIHsKICAgICAgb3duS2V5cyhPYmplY3Qoc291cmNlKSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgcmV0dXJuIHRhcmdldDsKfQoKZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkgewogIGlmIChrZXkgaW4gb2JqKSB7CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsKICAgICAgdmFsdWU6IHZhbHVlLAogICAgICBlbnVtZXJhYmxlOiB0cnVlLAogICAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICAgIHdyaXRhYmxlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CgogIHJldHVybiBvYmo7Cn0KCmltcG9ydCB7IENPTVBPTkVOVF9VSURfS0VZLCBWdWUgfSBmcm9tICcuLi8uLi92dWUnOwppbXBvcnQgeyBOQU1FX01PREFMIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL2NvbXBvbmVudHMnOwppbXBvcnQgeyBJU19CUk9XU0VSIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL2Vudic7CmltcG9ydCB7IEVWRU5UX05BTUVfQ0FOQ0VMLCBFVkVOVF9OQU1FX0NIQU5HRSwgRVZFTlRfTkFNRV9DTE9TRSwgRVZFTlRfTkFNRV9ISURERU4sIEVWRU5UX05BTUVfSElERSwgRVZFTlRfTkFNRV9PSywgRVZFTlRfTkFNRV9TSE9XLCBFVkVOVF9OQU1FX1NIT1dOLCBFVkVOVF9OQU1FX1RPR0dMRSwgRVZFTlRfT1BUSU9OU19OT19DQVBUVVJFIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL2V2ZW50cyc7CmltcG9ydCB7IENPREVfRVNDIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL2tleS1jb2Rlcyc7CmltcG9ydCB7IFBST1BfVFlQRV9BUlJBWV9PQkpFQ1RfU1RSSU5HLCBQUk9QX1RZUEVfQVJSQVlfU1RSSU5HLCBQUk9QX1RZUEVfQk9PTEVBTiwgUFJPUF9UWVBFX09CSkVDVCwgUFJPUF9UWVBFX1NUUklORyB9IGZyb20gJy4uLy4uL2NvbnN0YW50cy9wcm9wcyc7CmltcG9ydCB7IEhUTUxFbGVtZW50IH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL3NhZmUtdHlwZXMnOwppbXBvcnQgeyBTTE9UX05BTUVfREVGQVVMVCwgU0xPVF9OQU1FX01PREFMX0JBQ0tEUk9QLCBTTE9UX05BTUVfTU9EQUxfQ0FOQ0VMLCBTTE9UX05BTUVfTU9EQUxfRk9PVEVSLCBTTE9UX05BTUVfTU9EQUxfSEVBREVSLCBTTE9UX05BTUVfTU9EQUxfSEVBREVSX0NMT1NFLCBTTE9UX05BTUVfTU9EQUxfT0ssIFNMT1RfTkFNRV9NT0RBTF9USVRMRSB9IGZyb20gJy4uLy4uL2NvbnN0YW50cy9zbG90cyc7CmltcG9ydCB7IGFycmF5SW5jbHVkZXMsIGNvbmNhdCB9IGZyb20gJy4uLy4uL3V0aWxzL2FycmF5JzsKaW1wb3J0IHsgYXR0ZW1wdEZvY3VzLCBjbG9zZXN0LCBjb250YWlucywgZ2V0QWN0aXZlRWxlbWVudCBhcyBfZ2V0QWN0aXZlRWxlbWVudCwgZ2V0VGFiYWJsZXMsIHJlcXVlc3RBRiwgc2VsZWN0IH0gZnJvbSAnLi4vLi4vdXRpbHMvZG9tJzsKaW1wb3J0IHsgZ2V0Um9vdEFjdGlvbkV2ZW50TmFtZSwgZ2V0Um9vdEV2ZW50TmFtZSwgZXZlbnRPbiwgZXZlbnRPZmYgfSBmcm9tICcuLi8uLi91dGlscy9ldmVudHMnOwppbXBvcnQgeyBodG1sT3JUZXh0IH0gZnJvbSAnLi4vLi4vdXRpbHMvaHRtbCc7CmltcG9ydCB7IGlkZW50aXR5IH0gZnJvbSAnLi4vLi4vdXRpbHMvaWRlbnRpdHknOwppbXBvcnQgeyBpc1N0cmluZywgaXNVbmRlZmluZWRPck51bGwgfSBmcm9tICcuLi8uLi91dGlscy9pbnNwZWN0JzsKaW1wb3J0IHsgbWFrZU1vZGVsTWl4aW4gfSBmcm9tICcuLi8uLi91dGlscy9tb2RlbCc7CmltcG9ydCB7IHNvcnRLZXlzIH0gZnJvbSAnLi4vLi4vdXRpbHMvb2JqZWN0JzsKaW1wb3J0IHsgb2JzZXJ2ZURvbSB9IGZyb20gJy4uLy4uL3V0aWxzL29ic2VydmUtZG9tJzsKaW1wb3J0IHsgbWFrZVByb3AsIG1ha2VQcm9wc0NvbmZpZ3VyYWJsZSB9IGZyb20gJy4uLy4uL3V0aWxzL3Byb3BzJzsKaW1wb3J0IHsgYXR0cnNNaXhpbiB9IGZyb20gJy4uLy4uL21peGlucy9hdHRycyc7CmltcG9ydCB7IGlkTWl4aW4sIHByb3BzIGFzIGlkUHJvcHMgfSBmcm9tICcuLi8uLi9taXhpbnMvaWQnOwppbXBvcnQgeyBsaXN0ZW5PbkRvY3VtZW50TWl4aW4gfSBmcm9tICcuLi8uLi9taXhpbnMvbGlzdGVuLW9uLWRvY3VtZW50JzsKaW1wb3J0IHsgbGlzdGVuT25Sb290TWl4aW4gfSBmcm9tICcuLi8uLi9taXhpbnMvbGlzdGVuLW9uLXJvb3QnOwppbXBvcnQgeyBsaXN0ZW5PbldpbmRvd01peGluIH0gZnJvbSAnLi4vLi4vbWl4aW5zL2xpc3Rlbi1vbi13aW5kb3cnOwppbXBvcnQgeyBub3JtYWxpemVTbG90TWl4aW4gfSBmcm9tICcuLi8uLi9taXhpbnMvbm9ybWFsaXplLXNsb3QnOwppbXBvcnQgeyBzY29wZWRTdHlsZU1peGluIH0gZnJvbSAnLi4vLi4vbWl4aW5zL3Njb3BlZC1zdHlsZSc7CmltcG9ydCB7IEJCdXR0b24gfSBmcm9tICcuLi9idXR0b24vYnV0dG9uJzsKaW1wb3J0IHsgQkJ1dHRvbkNsb3NlIH0gZnJvbSAnLi4vYnV0dG9uL2J1dHRvbi1jbG9zZSc7CmltcG9ydCB7IEJWVHJhbnNpdGlvbiB9IGZyb20gJy4uL3RyYW5zaXRpb24vYnYtdHJhbnNpdGlvbic7CmltcG9ydCB7IEJWVHJhbnNwb3J0ZXIgfSBmcm9tICcuLi90cmFuc3BvcnRlci90cmFuc3BvcnRlcic7CmltcG9ydCB7IEJ2TW9kYWxFdmVudCB9IGZyb20gJy4vaGVscGVycy9idi1tb2RhbC1ldmVudC5jbGFzcyc7CmltcG9ydCB7IG1vZGFsTWFuYWdlciB9IGZyb20gJy4vaGVscGVycy9tb2RhbC1tYW5hZ2VyJzsgLy8gLS0tIENvbnN0YW50cyAtLS0KCnZhciBfbWFrZU1vZGVsTWl4aW4gPSBtYWtlTW9kZWxNaXhpbigndmlzaWJsZScsIHsKICB0eXBlOiBQUk9QX1RZUEVfQk9PTEVBTiwKICBkZWZhdWx0VmFsdWU6IGZhbHNlLAogIGV2ZW50OiBFVkVOVF9OQU1FX0NIQU5HRQp9KSwKICAgIG1vZGVsTWl4aW4gPSBfbWFrZU1vZGVsTWl4aW4ubWl4aW4sCiAgICBtb2RlbFByb3BzID0gX21ha2VNb2RlbE1peGluLnByb3BzLAogICAgTU9ERUxfUFJPUF9OQU1FID0gX21ha2VNb2RlbE1peGluLnByb3AsCiAgICBNT0RFTF9FVkVOVF9OQU1FID0gX21ha2VNb2RlbE1peGluLmV2ZW50OwoKdmFyIFRSSUdHRVJfQkFDS0RST1AgPSAnYmFja2Ryb3AnOwp2YXIgVFJJR0dFUl9FU0MgPSAnZXNjJzsKdmFyIFRSSUdHRVJfRk9SQ0UgPSAnRk9SQ0UnOwp2YXIgVFJJR0dFUl9UT0dHTEUgPSAndG9nZ2xlJzsKdmFyIEJVVFRPTl9DQU5DRUwgPSAnY2FuY2VsJzsgLy8gVE9ETzogVGhpcyBzaG91bGQgYmUgcmVuYW1lZCB0byAnY2xvc2UnCgp2YXIgQlVUVE9OX0NMT1NFID0gJ2hlYWRlcmNsb3NlJzsKdmFyIEJVVFRPTl9PSyA9ICdvayc7CnZhciBCVVRUT05TID0gW0JVVFRPTl9DQU5DRUwsIEJVVFRPTl9DTE9TRSwgQlVUVE9OX09LXTsgLy8gYE9ic2VydmVEb21gIGNvbmZpZyB0byBkZXRlY3QgY2hhbmdlcyBpbiBtb2RhbCBjb250ZW50Ci8vIHNvIHRoYXQgd2UgY2FuIGFkanVzdCB0aGUgbW9kYWwgcGFkZGluZyBpZiBuZWVkZWQKCnZhciBPQlNFUlZFUl9DT05GSUcgPSB7CiAgc3VidHJlZTogdHJ1ZSwKICBjaGlsZExpc3Q6IHRydWUsCiAgY2hhcmFjdGVyRGF0YTogdHJ1ZSwKICBhdHRyaWJ1dGVzOiB0cnVlLAogIGF0dHJpYnV0ZUZpbHRlcjogWydzdHlsZScsICdjbGFzcyddCn07IC8vIC0tLSBQcm9wcyAtLS0KCmV4cG9ydCB2YXIgcHJvcHMgPSBtYWtlUHJvcHNDb25maWd1cmFibGUoc29ydEtleXMoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIGlkUHJvcHMpLCBtb2RlbFByb3BzKSwge30sIHsKICBhcmlhTGFiZWw6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcpLAogIGF1dG9Gb2N1c0J1dHRvbjogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORywgbnVsbCwKICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogIGZ1bmN0aW9uICh2YWx1ZSkgewogICAgcmV0dXJuIGlzVW5kZWZpbmVkT3JOdWxsKHZhbHVlKSB8fCBhcnJheUluY2x1ZGVzKEJVVFRPTlMsIHZhbHVlKTsKICB9KSwKICBib2R5QmdWYXJpYW50OiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HKSwKICBib2R5Q2xhc3M6IG1ha2VQcm9wKFBST1BfVFlQRV9BUlJBWV9PQkpFQ1RfU1RSSU5HKSwKICBib2R5VGV4dFZhcmlhbnQ6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcpLAogIGJ1c3k6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgYnV0dG9uU2l6ZTogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORyksCiAgY2FuY2VsRGlzYWJsZWQ6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgY2FuY2VsVGl0bGU6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcsICdDYW5jZWwnKSwKICBjYW5jZWxUaXRsZUh0bWw6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcpLAogIGNhbmNlbFZhcmlhbnQ6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcsICdzZWNvbmRhcnknKSwKICBjZW50ZXJlZDogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICBjb250ZW50Q2xhc3M6IG1ha2VQcm9wKFBST1BfVFlQRV9BUlJBWV9PQkpFQ1RfU1RSSU5HKSwKICBkaWFsb2dDbGFzczogbWFrZVByb3AoUFJPUF9UWVBFX0FSUkFZX09CSkVDVF9TVFJJTkcpLAogIGZvb3RlckJnVmFyaWFudDogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORyksCiAgZm9vdGVyQm9yZGVyVmFyaWFudDogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORyksCiAgZm9vdGVyQ2xhc3M6IG1ha2VQcm9wKFBST1BfVFlQRV9BUlJBWV9PQkpFQ1RfU1RSSU5HKSwKICBmb290ZXJUZXh0VmFyaWFudDogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORyksCiAgaGVhZGVyQmdWYXJpYW50OiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HKSwKICBoZWFkZXJCb3JkZXJWYXJpYW50OiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HKSwKICBoZWFkZXJDbGFzczogbWFrZVByb3AoUFJPUF9UWVBFX0FSUkFZX09CSkVDVF9TVFJJTkcpLAogIGhlYWRlckNsb3NlQ29udGVudDogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORywgJyZ0aW1lczsnKSwKICBoZWFkZXJDbG9zZUxhYmVsOiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCAnQ2xvc2UnKSwKICBoZWFkZXJDbG9zZVZhcmlhbnQ6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcpLAogIGhlYWRlclRleHRWYXJpYW50OiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HKSwKICAvLyBUT0RPOiBSZW5hbWUgdG8gYG5vQmFja2Ryb3BgIGFuZCBkZXByZWNhdGUgYGhpZGVCYWNrZHJvcGAKICBoaWRlQmFja2Ryb3A6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgLy8gVE9ETzogUmVuYW1lIHRvIGBub0Zvb3RlcmAgYW5kIGRlcHJlY2F0ZSBgaGlkZUZvb3RlcmAKICBoaWRlRm9vdGVyOiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIC8vIFRPRE86IFJlbmFtZSB0byBgbm9IZWFkZXJgIGFuZCBkZXByZWNhdGUgYGhpZGVIZWFkZXJgCiAgaGlkZUhlYWRlcjogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICAvLyBUT0RPOiBSZW5hbWUgdG8gYG5vSGVhZGVyQ2xvc2VgIGFuZCBkZXByZWNhdGUgYGhpZGVIZWFkZXJDbG9zZWAKICBoaWRlSGVhZGVyQ2xvc2U6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgaWdub3JlRW5mb3JjZUZvY3VzU2VsZWN0b3I6IG1ha2VQcm9wKFBST1BfVFlQRV9BUlJBWV9TVFJJTkcpLAogIGxhenk6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgbW9kYWxDbGFzczogbWFrZVByb3AoUFJPUF9UWVBFX0FSUkFZX09CSkVDVF9TVFJJTkcpLAogIG5vQ2xvc2VPbkJhY2tkcm9wOiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIG5vQ2xvc2VPbkVzYzogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICBub0VuZm9yY2VGb2N1czogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICBub0ZhZGU6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgbm9TdGFja2luZzogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICBva0Rpc2FibGVkOiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIG9rT25seTogbWFrZVByb3AoUFJPUF9UWVBFX0JPT0xFQU4sIGZhbHNlKSwKICBva1RpdGxlOiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCAnT0snKSwKICBva1RpdGxlSHRtbDogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORyksCiAgb2tWYXJpYW50OiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCAncHJpbWFyeScpLAogIC8vIEhUTUwgRWxlbWVudCwgQ1NTIHNlbGVjdG9yIHN0cmluZyBvciBWdWUgY29tcG9uZW50IGluc3RhbmNlCiAgcmV0dXJuRm9jdXM6IG1ha2VQcm9wKFtIVE1MRWxlbWVudCwgUFJPUF9UWVBFX09CSkVDVCwgUFJPUF9UWVBFX1NUUklOR10pLAogIHNjcm9sbGFibGU6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgc2l6ZTogbWFrZVByb3AoUFJPUF9UWVBFX1NUUklORywgJ21kJyksCiAgInN0YXRpYyI6IG1ha2VQcm9wKFBST1BfVFlQRV9CT09MRUFOLCBmYWxzZSksCiAgdGl0bGU6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcpLAogIHRpdGxlQ2xhc3M6IG1ha2VQcm9wKFBST1BfVFlQRV9BUlJBWV9PQkpFQ1RfU1RSSU5HKSwKICB0aXRsZUh0bWw6IG1ha2VQcm9wKFBST1BfVFlQRV9TVFJJTkcpLAogIHRpdGxlU3JPbmx5OiBtYWtlUHJvcChQUk9QX1RZUEVfQk9PTEVBTiwgZmFsc2UpLAogIHRpdGxlVGFnOiBtYWtlUHJvcChQUk9QX1RZUEVfU1RSSU5HLCAnaDUnKQp9KSksIE5BTUVfTU9EQUwpOyAvLyAtLS0gTWFpbiBjb21wb25lbnQgLS0tCi8vIEB2dWUvY29tcG9uZW50CgpleHBvcnQgdmFyIEJNb2RhbCA9IC8qI19fUFVSRV9fKi9WdWUuZXh0ZW5kKHsKICBuYW1lOiBOQU1FX01PREFMLAogIG1peGluczogW2F0dHJzTWl4aW4sIGlkTWl4aW4sIG1vZGVsTWl4aW4sIGxpc3Rlbk9uRG9jdW1lbnRNaXhpbiwgbGlzdGVuT25Sb290TWl4aW4sIGxpc3Rlbk9uV2luZG93TWl4aW4sIG5vcm1hbGl6ZVNsb3RNaXhpbiwgc2NvcGVkU3R5bGVNaXhpbl0sCiAgaW5oZXJpdEF0dHJzOiBmYWxzZSwKICBwcm9wczogcHJvcHMsCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGlzSGlkZGVuOiB0cnVlLAogICAgICAvLyBJZiBtb2RhbCBzaG91bGQgbm90IGJlIGluIGRvY3VtZW50CiAgICAgIGlzVmlzaWJsZTogZmFsc2UsCiAgICAgIC8vIENvbnRyb2xzIG1vZGFsIHZpc2libGUgc3RhdGUKICAgICAgaXNUcmFuc2l0aW9uaW5nOiBmYWxzZSwKICAgICAgLy8gVXNlZCBmb3Igc3R5bGUgY29udHJvbAogICAgICBpc1Nob3c6IGZhbHNlLAogICAgICAvLyBVc2VkIGZvciBzdHlsZSBjb250cm9sCiAgICAgIGlzQmxvY2s6IGZhbHNlLAogICAgICAvLyBVc2VkIGZvciBzdHlsZSBjb250cm9sCiAgICAgIGlzT3BlbmluZzogZmFsc2UsCiAgICAgIC8vIFRvIHNpZ25hbCB0aGF0IHRoZSBtb2RhbCBpcyBpbiB0aGUgcHJvY2VzcyBvZiBvcGVuaW5nCiAgICAgIGlzQ2xvc2luZzogZmFsc2UsCiAgICAgIC8vIFRvIHNpZ25hbCB0aGF0IHRoZSBtb2RhbCBpcyBpbiB0aGUgcHJvY2VzcyBvZiBjbG9zaW5nCiAgICAgIGlnbm9yZUJhY2tkcm9wQ2xpY2s6IGZhbHNlLAogICAgICAvLyBVc2VkIHRvIHNpZ25pZnkgaWYgY2xpY2sgb3V0IGxpc3RlbmVyIHNob3VsZCBpZ25vcmUgdGhlIGNsaWNrCiAgICAgIGlzTW9kYWxPdmVyZmxvd2luZzogZmFsc2UsCiAgICAgIC8vIFRoZSBmb2xsb3dpbmcgaXRlbXMgYXJlIGNvbnRyb2xsZWQgYnkgdGhlIG1vZGFsTWFuYWdlciBpbnN0YW5jZQogICAgICBzY3JvbGxiYXJXaWR0aDogMCwKICAgICAgekluZGV4OiBtb2RhbE1hbmFnZXIuZ2V0QmFzZVpJbmRleCgpLAogICAgICBpc1RvcDogdHJ1ZSwKICAgICAgaXNCb2R5T3ZlcmZsb3dpbmc6IGZhbHNlCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIG1vZGFsSWQ6IGZ1bmN0aW9uIG1vZGFsSWQoKSB7CiAgICAgIHJldHVybiB0aGlzLnNhZmVJZCgpOwogICAgfSwKICAgIG1vZGFsT3V0ZXJJZDogZnVuY3Rpb24gbW9kYWxPdXRlcklkKCkgewogICAgICByZXR1cm4gdGhpcy5zYWZlSWQoJ19fQlZfbW9kYWxfb3V0ZXJfJyk7CiAgICB9LAogICAgbW9kYWxIZWFkZXJJZDogZnVuY3Rpb24gbW9kYWxIZWFkZXJJZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuc2FmZUlkKCdfX0JWX21vZGFsX2hlYWRlcl8nKTsKICAgIH0sCiAgICBtb2RhbEJvZHlJZDogZnVuY3Rpb24gbW9kYWxCb2R5SWQoKSB7CiAgICAgIHJldHVybiB0aGlzLnNhZmVJZCgnX19CVl9tb2RhbF9ib2R5XycpOwogICAgfSwKICAgIG1vZGFsVGl0bGVJZDogZnVuY3Rpb24gbW9kYWxUaXRsZUlkKCkgewogICAgICByZXR1cm4gdGhpcy5zYWZlSWQoJ19fQlZfbW9kYWxfdGl0bGVfJyk7CiAgICB9LAogICAgbW9kYWxDb250ZW50SWQ6IGZ1bmN0aW9uIG1vZGFsQ29udGVudElkKCkgewogICAgICByZXR1cm4gdGhpcy5zYWZlSWQoJ19fQlZfbW9kYWxfY29udGVudF8nKTsKICAgIH0sCiAgICBtb2RhbEZvb3RlcklkOiBmdW5jdGlvbiBtb2RhbEZvb3RlcklkKCkgewogICAgICByZXR1cm4gdGhpcy5zYWZlSWQoJ19fQlZfbW9kYWxfZm9vdGVyXycpOwogICAgfSwKICAgIG1vZGFsQmFja2Ryb3BJZDogZnVuY3Rpb24gbW9kYWxCYWNrZHJvcElkKCkgewogICAgICByZXR1cm4gdGhpcy5zYWZlSWQoJ19fQlZfbW9kYWxfYmFja2Ryb3BfJyk7CiAgICB9LAogICAgbW9kYWxDbGFzc2VzOiBmdW5jdGlvbiBtb2RhbENsYXNzZXMoKSB7CiAgICAgIHJldHVybiBbewogICAgICAgIGZhZGU6ICF0aGlzLm5vRmFkZSwKICAgICAgICBzaG93OiB0aGlzLmlzU2hvdwogICAgICB9LCB0aGlzLm1vZGFsQ2xhc3NdOwogICAgfSwKICAgIG1vZGFsU3R5bGVzOiBmdW5jdGlvbiBtb2RhbFN0eWxlcygpIHsKICAgICAgdmFyIHNiV2lkdGggPSAiIi5jb25jYXQodGhpcy5zY3JvbGxiYXJXaWR0aCwgInB4Iik7CiAgICAgIHJldHVybiB7CiAgICAgICAgcGFkZGluZ0xlZnQ6ICF0aGlzLmlzQm9keU92ZXJmbG93aW5nICYmIHRoaXMuaXNNb2RhbE92ZXJmbG93aW5nID8gc2JXaWR0aCA6ICcnLAogICAgICAgIHBhZGRpbmdSaWdodDogdGhpcy5pc0JvZHlPdmVyZmxvd2luZyAmJiAhdGhpcy5pc01vZGFsT3ZlcmZsb3dpbmcgPyBzYldpZHRoIDogJycsCiAgICAgICAgLy8gTmVlZGVkIHRvIGZpeCBpc3N1ZSBodHRwczovL2dpdGh1Yi5jb20vYm9vdHN0cmFwLXZ1ZS9ib290c3RyYXAtdnVlL2lzc3Vlcy8zNDU3CiAgICAgICAgLy8gRXZlbiB0aG91Z2ggd2UgYXJlIHVzaW5nIHYtc2hvdywgd2UgbXVzdCBlbnN1cmUgJ25vbmUnIGlzIHJlc3RvcmVkIGluIHRoZSBzdHlsZXMKICAgICAgICBkaXNwbGF5OiB0aGlzLmlzQmxvY2sgPyAnYmxvY2snIDogJ25vbmUnCiAgICAgIH07CiAgICB9LAogICAgZGlhbG9nQ2xhc3NlczogZnVuY3Rpb24gZGlhbG9nQ2xhc3NlcygpIHsKICAgICAgdmFyIF9yZWY7CgogICAgICByZXR1cm4gWyhfcmVmID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfcmVmLCAibW9kYWwtIi5jb25jYXQodGhpcy5zaXplKSwgdGhpcy5zaXplKSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICdtb2RhbC1kaWFsb2ctY2VudGVyZWQnLCB0aGlzLmNlbnRlcmVkKSwgX2RlZmluZVByb3BlcnR5KF9yZWYsICdtb2RhbC1kaWFsb2ctc2Nyb2xsYWJsZScsIHRoaXMuc2Nyb2xsYWJsZSksIF9yZWYpLCB0aGlzLmRpYWxvZ0NsYXNzXTsKICAgIH0sCiAgICBoZWFkZXJDbGFzc2VzOiBmdW5jdGlvbiBoZWFkZXJDbGFzc2VzKCkgewogICAgICB2YXIgX3JlZjI7CgogICAgICByZXR1cm4gWyhfcmVmMiA9IHt9LCBfZGVmaW5lUHJvcGVydHkoX3JlZjIsICJiZy0iLmNvbmNhdCh0aGlzLmhlYWRlckJnVmFyaWFudCksIHRoaXMuaGVhZGVyQmdWYXJpYW50KSwgX2RlZmluZVByb3BlcnR5KF9yZWYyLCAidGV4dC0iLmNvbmNhdCh0aGlzLmhlYWRlclRleHRWYXJpYW50KSwgdGhpcy5oZWFkZXJUZXh0VmFyaWFudCksIF9kZWZpbmVQcm9wZXJ0eShfcmVmMiwgImJvcmRlci0iLmNvbmNhdCh0aGlzLmhlYWRlckJvcmRlclZhcmlhbnQpLCB0aGlzLmhlYWRlckJvcmRlclZhcmlhbnQpLCBfcmVmMiksIHRoaXMuaGVhZGVyQ2xhc3NdOwogICAgfSwKICAgIHRpdGxlQ2xhc3NlczogZnVuY3Rpb24gdGl0bGVDbGFzc2VzKCkgewogICAgICByZXR1cm4gW3sKICAgICAgICAnc3Itb25seSc6IHRoaXMudGl0bGVTck9ubHkKICAgICAgfSwgdGhpcy50aXRsZUNsYXNzXTsKICAgIH0sCiAgICBib2R5Q2xhc3NlczogZnVuY3Rpb24gYm9keUNsYXNzZXMoKSB7CiAgICAgIHZhciBfcmVmMzsKCiAgICAgIHJldHVybiBbKF9yZWYzID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfcmVmMywgImJnLSIuY29uY2F0KHRoaXMuYm9keUJnVmFyaWFudCksIHRoaXMuYm9keUJnVmFyaWFudCksIF9kZWZpbmVQcm9wZXJ0eShfcmVmMywgInRleHQtIi5jb25jYXQodGhpcy5ib2R5VGV4dFZhcmlhbnQpLCB0aGlzLmJvZHlUZXh0VmFyaWFudCksIF9yZWYzKSwgdGhpcy5ib2R5Q2xhc3NdOwogICAgfSwKICAgIGZvb3RlckNsYXNzZXM6IGZ1bmN0aW9uIGZvb3RlckNsYXNzZXMoKSB7CiAgICAgIHZhciBfcmVmNDsKCiAgICAgIHJldHVybiBbKF9yZWY0ID0ge30sIF9kZWZpbmVQcm9wZXJ0eShfcmVmNCwgImJnLSIuY29uY2F0KHRoaXMuZm9vdGVyQmdWYXJpYW50KSwgdGhpcy5mb290ZXJCZ1ZhcmlhbnQpLCBfZGVmaW5lUHJvcGVydHkoX3JlZjQsICJ0ZXh0LSIuY29uY2F0KHRoaXMuZm9vdGVyVGV4dFZhcmlhbnQpLCB0aGlzLmZvb3RlclRleHRWYXJpYW50KSwgX2RlZmluZVByb3BlcnR5KF9yZWY0LCAiYm9yZGVyLSIuY29uY2F0KHRoaXMuZm9vdGVyQm9yZGVyVmFyaWFudCksIHRoaXMuZm9vdGVyQm9yZGVyVmFyaWFudCksIF9yZWY0KSwgdGhpcy5mb290ZXJDbGFzc107CiAgICB9LAogICAgbW9kYWxPdXRlclN0eWxlOiBmdW5jdGlvbiBtb2RhbE91dGVyU3R5bGUoKSB7CiAgICAgIC8vIFN0eWxlcyBuZWVkZWQgZm9yIHByb3BlciBzdGFja2luZyBvZiBtb2RhbHMKICAgICAgcmV0dXJuIHsKICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgICB6SW5kZXg6IHRoaXMuekluZGV4CiAgICAgIH07CiAgICB9LAogICAgc2xvdFNjb3BlOiBmdW5jdGlvbiBzbG90U2NvcGUoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgY2FuY2VsOiB0aGlzLm9uQ2FuY2VsLAogICAgICAgIGNsb3NlOiB0aGlzLm9uQ2xvc2UsCiAgICAgICAgaGlkZTogdGhpcy5oaWRlLAogICAgICAgIG9rOiB0aGlzLm9uT2ssCiAgICAgICAgdmlzaWJsZTogdGhpcy5pc1Zpc2libGUKICAgICAgfTsKICAgIH0sCiAgICBjb21wdXRlSWdub3JlRW5mb3JjZUZvY3VzU2VsZWN0b3I6IGZ1bmN0aW9uIGNvbXB1dGVJZ25vcmVFbmZvcmNlRm9jdXNTZWxlY3RvcigpIHsKICAgICAgLy8gTm9ybWFsaXplIHRvIGFuIHNpbmdsZSBzZWxlY3RvciB3aXRoIHNlbGVjdG9ycyBzZXBhcmF0ZWQgYnkgYCxgCiAgICAgIHJldHVybiBjb25jYXQodGhpcy5pZ25vcmVFbmZvcmNlRm9jdXNTZWxlY3RvcikuZmlsdGVyKGlkZW50aXR5KS5qb2luKCcsJykudHJpbSgpOwogICAgfSwKICAgIGNvbXB1dGVkQXR0cnM6IGZ1bmN0aW9uIGNvbXB1dGVkQXR0cnMoKSB7CiAgICAgIC8vIElmIHRoZSBwYXJlbnQgaGFzIGEgc2NvcGVkIHN0eWxlIGF0dHJpYnV0ZSwgYW5kIHRoZSBtb2RhbAogICAgICAvLyBpcyBwb3J0YWxsZWQsIGFkZCB0aGUgc2NvcGVkIGF0dHJpYnV0ZSB0byB0aGUgbW9kYWwgd3JhcHBlcgogICAgICB2YXIgc2NvcGVkU3R5bGVBdHRycyA9ICF0aGlzWyJzdGF0aWMiXSA/IHRoaXMuc2NvcGVkU3R5bGVBdHRycyA6IHt9OwogICAgICByZXR1cm4gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHNjb3BlZFN0eWxlQXR0cnMpLCB0aGlzLmJ2QXR0cnMpLCB7fSwgewogICAgICAgIGlkOiB0aGlzLm1vZGFsT3V0ZXJJZAogICAgICB9KTsKICAgIH0sCiAgICBjb21wdXRlZE1vZGFsQXR0cnM6IGZ1bmN0aW9uIGNvbXB1dGVkTW9kYWxBdHRycygpIHsKICAgICAgdmFyIGlzVmlzaWJsZSA9IHRoaXMuaXNWaXNpYmxlLAogICAgICAgICAgYXJpYUxhYmVsID0gdGhpcy5hcmlhTGFiZWw7CiAgICAgIHJldHVybiB7CiAgICAgICAgaWQ6IHRoaXMubW9kYWxJZCwKICAgICAgICByb2xlOiAnZGlhbG9nJywKICAgICAgICAnYXJpYS1oaWRkZW4nOiBpc1Zpc2libGUgPyBudWxsIDogJ3RydWUnLAogICAgICAgICdhcmlhLW1vZGFsJzogaXNWaXNpYmxlID8gJ3RydWUnIDogbnVsbCwKICAgICAgICAnYXJpYS1sYWJlbCc6IGFyaWFMYWJlbCwKICAgICAgICAnYXJpYS1sYWJlbGxlZGJ5JzogdGhpcy5oaWRlSGVhZGVyIHx8IGFyaWFMYWJlbCB8fCAvLyBUT0RPOiBSZW5hbWUgc2xvdCB0byBgdGl0bGVgIGFuZCBkZXByZWNhdGUgYG1vZGFsLXRpdGxlYAogICAgICAgICEodGhpcy5oYXNOb3JtYWxpemVkU2xvdChTTE9UX05BTUVfTU9EQUxfVElUTEUpIHx8IHRoaXMudGl0bGVIdG1sIHx8IHRoaXMudGl0bGUpID8gbnVsbCA6IHRoaXMubW9kYWxUaXRsZUlkLAogICAgICAgICdhcmlhLWRlc2NyaWJlZGJ5JzogdGhpcy5tb2RhbEJvZHlJZAogICAgICB9OwogICAgfQogIH0sCiAgd2F0Y2g6IF9kZWZpbmVQcm9wZXJ0eSh7fSwgTU9ERUxfUFJPUF9OQU1FLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7CiAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7CiAgICAgIHRoaXNbbmV3VmFsdWUgPyAnc2hvdycgOiAnaGlkZSddKCk7CiAgICB9CiAgfSksCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIC8vIERlZmluZSBub24tcmVhY3RpdmUgcHJvcGVydGllcwogICAgdGhpcy4kX29ic2VydmVyID0gbnVsbDsKICAgIHRoaXMuJF9yZXR1cm5Gb2N1cyA9IHRoaXMucmV0dXJuRm9jdXMgfHwgbnVsbDsKICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICAvLyBTZXQgaW5pdGlhbCB6LWluZGV4IGFzIHF1ZXJpZWQgZnJvbSB0aGUgRE9NCiAgICB0aGlzLnpJbmRleCA9IG1vZGFsTWFuYWdlci5nZXRCYXNlWkluZGV4KCk7IC8vIExpc3RlbiBmb3IgZXZlbnRzIGZyb20gb3RoZXJzIHRvIGVpdGhlciBvcGVuIG9yIGNsb3NlIG91cnNlbHZlcwogICAgLy8gYW5kIGxpc3RlbiB0byBhbGwgbW9kYWxzIHRvIGVuYWJsZS9kaXNhYmxlIGVuZm9yY2UgZm9jdXMKCiAgICB0aGlzLmxpc3Rlbk9uUm9vdChnZXRSb290QWN0aW9uRXZlbnROYW1lKE5BTUVfTU9EQUwsIEVWRU5UX05BTUVfU0hPVyksIHRoaXMuc2hvd0hhbmRsZXIpOwogICAgdGhpcy5saXN0ZW5PblJvb3QoZ2V0Um9vdEFjdGlvbkV2ZW50TmFtZShOQU1FX01PREFMLCBFVkVOVF9OQU1FX0hJREUpLCB0aGlzLmhpZGVIYW5kbGVyKTsKICAgIHRoaXMubGlzdGVuT25Sb290KGdldFJvb3RBY3Rpb25FdmVudE5hbWUoTkFNRV9NT0RBTCwgRVZFTlRfTkFNRV9UT0dHTEUpLCB0aGlzLnRvZ2dsZUhhbmRsZXIpOyAvLyBMaXN0ZW4gZm9yIGBidjptb2RhbDo6c2hvdyBldmVudHNgLCBhbmQgY2xvc2Ugb3Vyc2VsdmVzIGlmIHRoZQogICAgLy8gb3BlbmluZyBtb2RhbCBub3QgdXMKCiAgICB0aGlzLmxpc3Rlbk9uUm9vdChnZXRSb290RXZlbnROYW1lKE5BTUVfTU9EQUwsIEVWRU5UX05BTUVfU0hPVyksIHRoaXMubW9kYWxMaXN0ZW5lcik7IC8vIEluaXRpYWxseSBzaG93IG1vZGFsPwoKICAgIGlmICh0aGlzW01PREVMX1BST1BfTkFNRV0gPT09IHRydWUpIHsKICAgICAgdGhpcy4kbmV4dFRpY2sodGhpcy5zaG93KTsKICAgIH0KICB9LAogIGJlZm9yZURlc3Ryb3k6IGZ1bmN0aW9uIGJlZm9yZURlc3Ryb3koKSB7CiAgICAvLyBFbnN1cmUgZXZlcnl0aGluZyBpcyBiYWNrIHRvIG5vcm1hbAogICAgdGhpcy5zZXRPYnNlcnZlcihmYWxzZSk7CgogICAgaWYgKHRoaXMuaXNWaXNpYmxlKSB7CiAgICAgIHRoaXMuaXNWaXNpYmxlID0gZmFsc2U7CiAgICAgIHRoaXMuaXNTaG93ID0gZmFsc2U7CiAgICAgIHRoaXMuaXNUcmFuc2l0aW9uaW5nID0gZmFsc2U7CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBzZXRPYnNlcnZlcjogZnVuY3Rpb24gc2V0T2JzZXJ2ZXIoKSB7CiAgICAgIHZhciBvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogZmFsc2U7CiAgICAgIHRoaXMuJF9vYnNlcnZlciAmJiB0aGlzLiRfb2JzZXJ2ZXIuZGlzY29ubmVjdCgpOwogICAgICB0aGlzLiRfb2JzZXJ2ZXIgPSBudWxsOwoKICAgICAgaWYgKG9uKSB7CiAgICAgICAgdGhpcy4kX29ic2VydmVyID0gb2JzZXJ2ZURvbSh0aGlzLiRyZWZzLmNvbnRlbnQsIHRoaXMuY2hlY2tNb2RhbE92ZXJmbG93LmJpbmQodGhpcyksIE9CU0VSVkVSX0NPTkZJRyk7CiAgICAgIH0KICAgIH0sCiAgICAvLyBQcml2YXRlIG1ldGhvZCB0byB1cGRhdGUgdGhlIHYtbW9kZWwKICAgIHVwZGF0ZU1vZGVsOiBmdW5jdGlvbiB1cGRhdGVNb2RlbCh2YWx1ZSkgewogICAgICBpZiAodmFsdWUgIT09IHRoaXNbTU9ERUxfUFJPUF9OQU1FXSkgewogICAgICAgIHRoaXMuJGVtaXQoTU9ERUxfRVZFTlRfTkFNRSwgdmFsdWUpOwogICAgICB9CiAgICB9LAogICAgLy8gUHJpdmF0ZSBtZXRob2QgdG8gY3JlYXRlIGEgQnZNb2RhbEV2ZW50IG9iamVjdAogICAgYnVpbGRFdmVudDogZnVuY3Rpb24gYnVpbGRFdmVudCh0eXBlKSB7CiAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICAgICAgcmV0dXJuIG5ldyBCdk1vZGFsRXZlbnQodHlwZSwgX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHsKICAgICAgICAvLyBEZWZhdWx0IG9wdGlvbnMKICAgICAgICBjYW5jZWxhYmxlOiBmYWxzZSwKICAgICAgICB0YXJnZXQ6IHRoaXMuJHJlZnMubW9kYWwgfHwgdGhpcy4kZWwgfHwgbnVsbCwKICAgICAgICByZWxhdGVkVGFyZ2V0OiBudWxsLAogICAgICAgIHRyaWdnZXI6IG51bGwKICAgICAgfSwgb3B0aW9ucyksIHt9LCB7CiAgICAgICAgLy8gT3B0aW9ucyB0aGF0IGNhbid0IGJlIG92ZXJyaWRkZW4KICAgICAgICB2dWVUYXJnZXQ6IHRoaXMsCiAgICAgICAgY29tcG9uZW50SWQ6IHRoaXMubW9kYWxJZAogICAgICB9KSk7CiAgICB9LAogICAgLy8gUHVibGljIG1ldGhvZCB0byBzaG93IG1vZGFsCiAgICBzaG93OiBmdW5jdGlvbiBzaG93KCkgewogICAgICBpZiAodGhpcy5pc1Zpc2libGUgfHwgdGhpcy5pc09wZW5pbmcpIHsKICAgICAgICAvLyBJZiBhbHJlYWR5IG9wZW4sIG9yIGluIHRoZSBwcm9jZXNzIG9mIG9wZW5pbmcsIGRvIG5vdGhpbmcKCiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCgogICAgICBpZiAodGhpcy5pc0Nsb3NpbmcpIHsKICAgICAgICAvLyBJZiB3ZSBhcmUgaW4gdGhlIHByb2Nlc3Mgb2YgY2xvc2luZywgd2FpdCB1bnRpbCBoaWRkZW4gYmVmb3JlIHJlLW9wZW5pbmcKCiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICB0aGlzLiRvbmNlKEVWRU5UX05BTUVfSElEREVOLCB0aGlzLnNob3cpOwogICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovCgogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5pc09wZW5pbmcgPSB0cnVlOyAvLyBTZXQgdGhlIGVsZW1lbnQgdG8gcmV0dXJuIGZvY3VzIHRvIHdoZW4gY2xvc2VkCgogICAgICB0aGlzLiRfcmV0dXJuRm9jdXMgPSB0aGlzLiRfcmV0dXJuRm9jdXMgfHwgdGhpcy5nZXRBY3RpdmVFbGVtZW50KCk7CiAgICAgIHZhciBzaG93RXZ0ID0gdGhpcy5idWlsZEV2ZW50KEVWRU5UX05BTUVfU0hPVywgewogICAgICAgIGNhbmNlbGFibGU6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZW1pdEV2ZW50KHNob3dFdnQpOyAvLyBEb24ndCBzaG93IGlmIGNhbmNlbGVkCgogICAgICBpZiAoc2hvd0V2dC5kZWZhdWx0UHJldmVudGVkIHx8IHRoaXMuaXNWaXNpYmxlKSB7CiAgICAgICAgdGhpcy5pc09wZW5pbmcgPSBmYWxzZTsgLy8gRW5zdXJlIHRoZSB2LW1vZGVsIHJlZmxlY3RzIHRoZSBjdXJyZW50IHN0YXRlCgogICAgICAgIHRoaXMudXBkYXRlTW9kZWwoZmFsc2UpOwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBTaG93IHRoZSBtb2RhbAoKCiAgICAgIHRoaXMuZG9TaG93KCk7CiAgICB9LAogICAgLy8gUHVibGljIG1ldGhvZCB0byBoaWRlIG1vZGFsCiAgICBoaWRlOiBmdW5jdGlvbiBoaWRlKCkgewogICAgICB2YXIgdHJpZ2dlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogJyc7CgogICAgICBpZiAoIXRoaXMuaXNWaXNpYmxlIHx8IHRoaXMuaXNDbG9zaW5nKSB7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHRoaXMuaXNDbG9zaW5nID0gdHJ1ZTsKICAgICAgdmFyIGhpZGVFdnQgPSB0aGlzLmJ1aWxkRXZlbnQoRVZFTlRfTkFNRV9ISURFLCB7CiAgICAgICAgY2FuY2VsYWJsZTogdHJpZ2dlciAhPT0gVFJJR0dFUl9GT1JDRSwKICAgICAgICB0cmlnZ2VyOiB0cmlnZ2VyIHx8IG51bGwKICAgICAgfSk7IC8vIFdlIGVtaXQgc3BlY2lmaWMgZXZlbnQgZm9yIG9uZSBvZiB0aGUgdGhyZWUgYnVpbHQtaW4gYnV0dG9ucwoKICAgICAgaWYgKHRyaWdnZXIgPT09IEJVVFRPTl9PSykgewogICAgICAgIHRoaXMuJGVtaXQoRVZFTlRfTkFNRV9PSywgaGlkZUV2dCk7CiAgICAgIH0gZWxzZSBpZiAodHJpZ2dlciA9PT0gQlVUVE9OX0NBTkNFTCkgewogICAgICAgIHRoaXMuJGVtaXQoRVZFTlRfTkFNRV9DQU5DRUwsIGhpZGVFdnQpOwogICAgICB9IGVsc2UgaWYgKHRyaWdnZXIgPT09IEJVVFRPTl9DTE9TRSkgewogICAgICAgIHRoaXMuJGVtaXQoRVZFTlRfTkFNRV9DTE9TRSwgaGlkZUV2dCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZW1pdEV2ZW50KGhpZGVFdnQpOyAvLyBIaWRlIGlmIG5vdCBjYW5jZWxlZAoKICAgICAgaWYgKGhpZGVFdnQuZGVmYXVsdFByZXZlbnRlZCB8fCAhdGhpcy5pc1Zpc2libGUpIHsKICAgICAgICB0aGlzLmlzQ2xvc2luZyA9IGZhbHNlOyAvLyBFbnN1cmUgdi1tb2RlbCByZWZsZWN0cyBjdXJyZW50IHN0YXRlCgogICAgICAgIHRoaXMudXBkYXRlTW9kZWwodHJ1ZSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIFN0b3Agb2JzZXJ2aW5nIGZvciBjb250ZW50IGNoYW5nZXMKCgogICAgICB0aGlzLnNldE9ic2VydmVyKGZhbHNlKTsgLy8gVHJpZ2dlciB0aGUgaGlkZSB0cmFuc2l0aW9uCgogICAgICB0aGlzLmlzVmlzaWJsZSA9IGZhbHNlOyAvLyBVcGRhdGUgdGhlIHYtbW9kZWwKCiAgICAgIHRoaXMudXBkYXRlTW9kZWwoZmFsc2UpOwogICAgfSwKICAgIC8vIFB1YmxpYyBtZXRob2QgdG8gdG9nZ2xlIG1vZGFsIHZpc2liaWxpdHkKICAgIHRvZ2dsZTogZnVuY3Rpb24gdG9nZ2xlKHRyaWdnZXJFbCkgewogICAgICBpZiAodHJpZ2dlckVsKSB7CiAgICAgICAgdGhpcy4kX3JldHVybkZvY3VzID0gdHJpZ2dlckVsOwogICAgICB9CgogICAgICBpZiAodGhpcy5pc1Zpc2libGUpIHsKICAgICAgICB0aGlzLmhpZGUoVFJJR0dFUl9UT0dHTEUpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2hvdygpOwogICAgICB9CiAgICB9LAogICAgLy8gUHJpdmF0ZSBtZXRob2QgdG8gZ2V0IHRoZSBjdXJyZW50IGRvY3VtZW50IGFjdGl2ZSBlbGVtZW50CiAgICBnZXRBY3RpdmVFbGVtZW50OiBmdW5jdGlvbiBnZXRBY3RpdmVFbGVtZW50KCkgewogICAgICAvLyBSZXR1cm5pbmcgZm9jdXMgdG8gYGRvY3VtZW50LmJvZHlgIG1heSBjYXVzZSB1bndhbnRlZCBzY3JvbGxzLAogICAgICAvLyBzbyB3ZSBleGNsdWRlIHNldHRpbmcgZm9jdXMgb24gYm9keQogICAgICB2YXIgYWN0aXZlRWxlbWVudCA9IF9nZXRBY3RpdmVFbGVtZW50KElTX0JST1dTRVIgPyBbZG9jdW1lbnQuYm9keV0gOiBbXSk7IC8vIFByZXNldCB0aGUgZmFsbGJhY2sgcmV0dXJuIGZvY3VzIHZhbHVlIGlmIGl0IGlzIG5vdCBzZXQKICAgICAgLy8gYGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRgIHNob3VsZCBiZSB0aGUgdHJpZ2dlciBlbGVtZW50IHRoYXQgd2FzIGNsaWNrZWQgb3IKICAgICAgLy8gaW4gdGhlIGNhc2Ugb2YgdXNpbmcgdGhlIHYtbW9kZWwsIHdoaWNoIGV2ZXIgZWxlbWVudCBoYXMgY3VycmVudCBmb2N1cwogICAgICAvLyBXaWxsIGJlIG92ZXJyaWRkZW4gYnkgc29tZSBjb21tYW5kcyBzdWNoIGFzIHRvZ2dsZSwgZXRjLgogICAgICAvLyBOb3RlOiBPbiBJRSAxMSwgYGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRgIG1heSBiZSBgbnVsbGAKICAgICAgLy8gU28gd2UgdGVzdCBpdCBmb3IgdHJ1dGhpbmVzcyBmaXJzdAogICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYm9vdHN0cmFwLXZ1ZS9ib290c3RyYXAtdnVlL2lzc3Vlcy8zMjA2CgoKICAgICAgcmV0dXJuIGFjdGl2ZUVsZW1lbnQgJiYgYWN0aXZlRWxlbWVudC5mb2N1cyA/IGFjdGl2ZUVsZW1lbnQgOiBudWxsOwogICAgfSwKICAgIC8vIFByaXZhdGUgbWV0aG9kIHRvIGZpbmlzaCBzaG93aW5nIG1vZGFsCiAgICBkb1Nob3c6IGZ1bmN0aW9uIGRvU2hvdygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQ6IGNvbW1lbnRpbmcgb3V0IGZvciBub3cgdW50aWwgd2UgY2FuIHRlc3Qgc3RhY2tpbmcgKi8KCgogICAgICBpZiAobW9kYWxNYW5hZ2VyLm1vZGFsc0FyZU9wZW4gJiYgdGhpcy5ub1N0YWNraW5nKSB7CiAgICAgICAgLy8gSWYgYW5vdGhlciBtb2RhbChzKSBpcyBhbHJlYWR5IG9wZW4sIHdhaXQgZm9yIGl0KHRoZW0pIHRvIGNsb3NlCiAgICAgICAgdGhpcy5saXN0ZW5PblJvb3RPbmNlKGdldFJvb3RFdmVudE5hbWUoTkFNRV9NT0RBTCwgRVZFTlRfTkFNRV9ISURERU4pLCB0aGlzLmRvU2hvdyk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBtb2RhbE1hbmFnZXIucmVnaXN0ZXJNb2RhbCh0aGlzKTsgLy8gUGxhY2UgbW9kYWwgaW4gRE9NCgogICAgICB0aGlzLmlzSGlkZGVuID0gZmFsc2U7CiAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBXZSBkbyB0aGlzIGluIGAkbmV4dFRpY2soKWAgdG8gZW5zdXJlIHRoZSBtb2RhbCBpcyBpbiBET00gZmlyc3QKICAgICAgICAvLyBiZWZvcmUgd2Ugc2hvdyBpdAogICAgICAgIF90aGlzLmlzVmlzaWJsZSA9IHRydWU7CiAgICAgICAgX3RoaXMuaXNPcGVuaW5nID0gZmFsc2U7IC8vIFVwZGF0ZSB0aGUgdi1tb2RlbAoKICAgICAgICBfdGhpcy51cGRhdGVNb2RlbCh0cnVlKTsKCiAgICAgICAgX3RoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIC8vIE9ic2VydmUgY2hhbmdlcyBpbiBtb2RhbCBjb250ZW50IGFuZCBhZGp1c3QgaWYgbmVjZXNzYXJ5CiAgICAgICAgICAvLyBJbiBhIGAkbmV4dFRpY2soKWAgaW4gY2FzZSBtb2RhbCBjb250ZW50IGlzIGxhenkKICAgICAgICAgIF90aGlzLnNldE9ic2VydmVyKHRydWUpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0sCiAgICAvLyBUcmFuc2l0aW9uIGhhbmRsZXJzCiAgICBvbkJlZm9yZUVudGVyOiBmdW5jdGlvbiBvbkJlZm9yZUVudGVyKCkgewogICAgICB0aGlzLmlzVHJhbnNpdGlvbmluZyA9IHRydWU7CiAgICAgIHRoaXMuc2V0UmVzaXplRXZlbnQodHJ1ZSk7CiAgICB9LAogICAgb25FbnRlcjogZnVuY3Rpb24gb25FbnRlcigpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB0aGlzLmlzQmxvY2sgPSB0cnVlOyAvLyBXZSBhZGQgdGhlIGBzaG93YCBjbGFzcyAxIGZyYW1lIGxhdGVyCiAgICAgIC8vIGByZXF1ZXN0QUYoKWAgcnVucyB0aGUgY2FsbGJhY2sgYmVmb3JlIHRoZSBuZXh0IHJlcGFpbnQsIHNvIHdlIG5lZWQKICAgICAgLy8gdHdvIGNhbGxzIHRvIGd1YXJhbnRlZSB0aGUgbmV4dCBmcmFtZSBoYXMgYmVlbiByZW5kZXJlZAoKICAgICAgcmVxdWVzdEFGKGZ1bmN0aW9uICgpIHsKICAgICAgICByZXF1ZXN0QUYoZnVuY3Rpb24gKCkgewogICAgICAgICAgX3RoaXMyLmlzU2hvdyA9IHRydWU7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKICAgIG9uQWZ0ZXJFbnRlcjogZnVuY3Rpb24gb25BZnRlckVudGVyKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMuY2hlY2tNb2RhbE92ZXJmbG93KCk7CiAgICAgIHRoaXMuaXNUcmFuc2l0aW9uaW5nID0gZmFsc2U7IC8vIFdlIHVzZSBgcmVxdWVzdEFGKClgIHRvIGFsbG93IHRyYW5zaXRpb24gaG9va3MgdG8gY29tcGxldGUKICAgICAgLy8gYmVmb3JlIHBhc3NpbmcgY29udHJvbCBvdmVyIHRvIHRoZSBvdGhlciBoYW5kbGVycwogICAgICAvLyBUaGlzIHdpbGwgYWxsb3cgdXNlcnMgdG8gbm90IGhhdmUgdG8gdXNlIGAkbmV4dFRpY2soKWAgb3IgYHJlcXVlc3RBRigpYAogICAgICAvLyB3aGVuIHRyeWluZyB0byBwcmUtZm9jdXMgYW4gZWxlbWVudAoKICAgICAgcmVxdWVzdEFGKGZ1bmN0aW9uICgpIHsKICAgICAgICBfdGhpczMuZW1pdEV2ZW50KF90aGlzMy5idWlsZEV2ZW50KEVWRU5UX05BTUVfU0hPV04pKTsKCiAgICAgICAgX3RoaXMzLnNldEVuZm9yY2VGb2N1cyh0cnVlKTsKCiAgICAgICAgX3RoaXMzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAvLyBEZWxheWVkIGluIGEgYCRuZXh0VGljaygpYCB0byBhbGxvdyB1c2VycyB0aW1lIHRvIHByZS1mb2N1cwogICAgICAgICAgLy8gYW4gZWxlbWVudCBpZiB0aGUgd2lzaAogICAgICAgICAgX3RoaXMzLmZvY3VzRmlyc3QoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAogICAgb25CZWZvcmVMZWF2ZTogZnVuY3Rpb24gb25CZWZvcmVMZWF2ZSgpIHsKICAgICAgdGhpcy5pc1RyYW5zaXRpb25pbmcgPSB0cnVlOwogICAgICB0aGlzLnNldFJlc2l6ZUV2ZW50KGZhbHNlKTsKICAgICAgdGhpcy5zZXRFbmZvcmNlRm9jdXMoZmFsc2UpOwogICAgfSwKICAgIG9uTGVhdmU6IGZ1bmN0aW9uIG9uTGVhdmUoKSB7CiAgICAgIC8vIFJlbW92ZSB0aGUgJ3Nob3cnIGNsYXNzCiAgICAgIHRoaXMuaXNTaG93ID0gZmFsc2U7CiAgICB9LAogICAgb25BZnRlckxlYXZlOiBmdW5jdGlvbiBvbkFmdGVyTGVhdmUoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdGhpcy5pc0Jsb2NrID0gZmFsc2U7CiAgICAgIHRoaXMuaXNUcmFuc2l0aW9uaW5nID0gZmFsc2U7CiAgICAgIHRoaXMuaXNNb2RhbE92ZXJmbG93aW5nID0gZmFsc2U7CiAgICAgIHRoaXMuaXNIaWRkZW4gPSB0cnVlOwogICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXM0LmlzQ2xvc2luZyA9IGZhbHNlOwogICAgICAgIG1vZGFsTWFuYWdlci51bnJlZ2lzdGVyTW9kYWwoX3RoaXM0KTsKCiAgICAgICAgX3RoaXM0LnJldHVybkZvY3VzVG8oKTsgLy8gVE9ETzogTmVlZCB0byBmaW5kIGEgd2F5IHRvIHBhc3MgdGhlIGB0cmlnZ2VyYCBwcm9wZXJ0eQogICAgICAgIC8vICAgICAgIHRvIHRoZSBgaGlkZGVuYCBldmVudCwgbm90IGp1c3Qgb25seSB0aGUgYGhpZGVgIGV2ZW50CgoKICAgICAgICBfdGhpczQuZW1pdEV2ZW50KF90aGlzNC5idWlsZEV2ZW50KEVWRU5UX05BTUVfSElEREVOKSk7CiAgICAgIH0pOwogICAgfSwKICAgIGVtaXRFdmVudDogZnVuY3Rpb24gZW1pdEV2ZW50KGJ2RXZlbnQpIHsKICAgICAgdmFyIHR5cGUgPSBidkV2ZW50LnR5cGU7IC8vIFdlIGVtaXQgb24gYCRyb290YCBmaXJzdCBpbiBjYXNlIGEgZ2xvYmFsIGxpc3RlbmVyIHdhbnRzIHRvIGNhbmNlbAogICAgICAvLyB0aGUgZXZlbnQgZmlyc3QgYmVmb3JlIHRoZSBpbnN0YW5jZSBlbWl0cyBpdHMgZXZlbnQKCiAgICAgIHRoaXMuZW1pdE9uUm9vdChnZXRSb290RXZlbnROYW1lKE5BTUVfTU9EQUwsIHR5cGUpLCBidkV2ZW50LCBidkV2ZW50LmNvbXBvbmVudElkKTsKICAgICAgdGhpcy4kZW1pdCh0eXBlLCBidkV2ZW50KTsKICAgIH0sCiAgICAvLyBVSSBldmVudCBoYW5kbGVycwogICAgb25EaWFsb2dNb3VzZWRvd246IGZ1bmN0aW9uIG9uRGlhbG9nTW91c2Vkb3duKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsgLy8gV2F0Y2ggdG8gc2VlIGlmIHRoZSBtYXRjaGluZyBtb3VzZXVwIGV2ZW50IG9jY3VycyBvdXRzaWRlIHRoZSBkaWFsb2cKICAgICAgLy8gQW5kIGlmIGl0IGRvZXMsIGNhbmNlbCB0aGUgY2xpY2tPdXQgaGFuZGxlcgoKCiAgICAgIHZhciBtb2RhbCA9IHRoaXMuJHJlZnMubW9kYWw7CgogICAgICB2YXIgb25jZU1vZGFsTW91c2V1cCA9IGZ1bmN0aW9uIG9uY2VNb2RhbE1vdXNldXAoZXZlbnQpIHsKICAgICAgICBldmVudE9mZihtb2RhbCwgJ21vdXNldXAnLCBvbmNlTW9kYWxNb3VzZXVwLCBFVkVOVF9PUFRJT05TX05PX0NBUFRVUkUpOwoKICAgICAgICBpZiAoZXZlbnQudGFyZ2V0ID09PSBtb2RhbCkgewogICAgICAgICAgX3RoaXM1Lmlnbm9yZUJhY2tkcm9wQ2xpY2sgPSB0cnVlOwogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGV2ZW50T24obW9kYWwsICdtb3VzZXVwJywgb25jZU1vZGFsTW91c2V1cCwgRVZFTlRfT1BUSU9OU19OT19DQVBUVVJFKTsKICAgIH0sCiAgICBvbkNsaWNrT3V0OiBmdW5jdGlvbiBvbkNsaWNrT3V0KGV2ZW50KSB7CiAgICAgIGlmICh0aGlzLmlnbm9yZUJhY2tkcm9wQ2xpY2spIHsKICAgICAgICAvLyBDbGljayB3YXMgaW5pdGlhdGVkIGluc2lkZSB0aGUgbW9kYWwgY29udGVudCwgYnV0IGZpbmlzaGVkIG91dHNpZGUuCiAgICAgICAgLy8gU2V0IGJ5IHRoZSBhYm92ZSBvbkRpYWxvZ01vdXNlZG93biBoYW5kbGVyCiAgICAgICAgdGhpcy5pZ25vcmVCYWNrZHJvcENsaWNrID0gZmFsc2U7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIERvIG5vdGhpbmcgaWYgbm90IHZpc2libGUsIGJhY2tkcm9wIGNsaWNrIGRpc2FibGVkLCBvciBlbGVtZW50CiAgICAgIC8vIHRoYXQgZ2VuZXJhdGVkIGNsaWNrIGV2ZW50IGlzIG5vIGxvbmdlciBpbiBkb2N1bWVudCBib2R5CgoKICAgICAgaWYgKCF0aGlzLmlzVmlzaWJsZSB8fCB0aGlzLm5vQ2xvc2VPbkJhY2tkcm9wIHx8ICFjb250YWlucyhkb2N1bWVudC5ib2R5LCBldmVudC50YXJnZXQpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIElmIGJhY2tkcm9wIGNsaWNrZWQsIGhpZGUgbW9kYWwKCgogICAgICBpZiAoIWNvbnRhaW5zKHRoaXMuJHJlZnMuY29udGVudCwgZXZlbnQudGFyZ2V0KSkgewogICAgICAgIHRoaXMuaGlkZShUUklHR0VSX0JBQ0tEUk9QKTsKICAgICAgfQogICAgfSwKICAgIG9uT2s6IGZ1bmN0aW9uIG9uT2soKSB7CiAgICAgIHRoaXMuaGlkZShCVVRUT05fT0spOwogICAgfSwKICAgIG9uQ2FuY2VsOiBmdW5jdGlvbiBvbkNhbmNlbCgpIHsKICAgICAgdGhpcy5oaWRlKEJVVFRPTl9DQU5DRUwpOwogICAgfSwKICAgIG9uQ2xvc2U6IGZ1bmN0aW9uIG9uQ2xvc2UoKSB7CiAgICAgIHRoaXMuaGlkZShCVVRUT05fQ0xPU0UpOwogICAgfSwKICAgIG9uRXNjOiBmdW5jdGlvbiBvbkVzYyhldmVudCkgewogICAgICAvLyBJZiBFU0MgcHJlc3NlZCwgaGlkZSBtb2RhbAogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gQ09ERV9FU0MgJiYgdGhpcy5pc1Zpc2libGUgJiYgIXRoaXMubm9DbG9zZU9uRXNjKSB7CiAgICAgICAgdGhpcy5oaWRlKFRSSUdHRVJfRVNDKTsKICAgICAgfQogICAgfSwKICAgIC8vIERvY3VtZW50IGZvY3VzaW4gbGlzdGVuZXIKICAgIGZvY3VzSGFuZGxlcjogZnVuY3Rpb24gZm9jdXNIYW5kbGVyKGV2ZW50KSB7CiAgICAgIC8vIElmIGZvY3VzIGxlYXZlcyBtb2RhbCBjb250ZW50LCBicmluZyBpdCBiYWNrCiAgICAgIHZhciBjb250ZW50ID0gdGhpcy4kcmVmcy5jb250ZW50OwogICAgICB2YXIgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0OwoKICAgICAgaWYgKHRoaXMubm9FbmZvcmNlRm9jdXMgfHwgIXRoaXMuaXNUb3AgfHwgIXRoaXMuaXNWaXNpYmxlIHx8ICFjb250ZW50IHx8IGRvY3VtZW50ID09PSB0YXJnZXQgfHwgY29udGFpbnMoY29udGVudCwgdGFyZ2V0KSB8fCB0aGlzLmNvbXB1dGVJZ25vcmVFbmZvcmNlRm9jdXNTZWxlY3RvciAmJiBjbG9zZXN0KHRoaXMuY29tcHV0ZUlnbm9yZUVuZm9yY2VGb2N1c1NlbGVjdG9yLCB0YXJnZXQsIHRydWUpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgdGFiYWJsZXMgPSBnZXRUYWJhYmxlcyh0aGlzLiRyZWZzLmNvbnRlbnQpOwogICAgICB2YXIgYm90dG9tVHJhcCA9IHRoaXMuJHJlZnNbJ2JvdHRvbS10cmFwJ107CiAgICAgIHZhciB0b3BUcmFwID0gdGhpcy4kcmVmc1sndG9wLXRyYXAnXTsKCiAgICAgIGlmIChib3R0b21UcmFwICYmIHRhcmdldCA9PT0gYm90dG9tVHJhcCkgewogICAgICAgIC8vIElmIHVzZXIgcHJlc3NlZCBUQUIgb3V0IG9mIG1vZGFsIGludG8gb3VyIGJvdHRvbSB0cmFiIHRyYXAgZWxlbWVudAogICAgICAgIC8vIEZpbmQgdGhlIGZpcnN0IHRhYmFibGUgZWxlbWVudCBpbiB0aGUgbW9kYWwgY29udGVudCBhbmQgZm9jdXMgaXQKICAgICAgICBpZiAoYXR0ZW1wdEZvY3VzKHRhYmFibGVzWzBdKSkgewogICAgICAgICAgLy8gRm9jdXMgd2FzIHN1Y2Nlc3NmdWwKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodG9wVHJhcCAmJiB0YXJnZXQgPT09IHRvcFRyYXApIHsKICAgICAgICAvLyBJZiB1c2VyIHByZXNzZWQgQ1RSTC1UQUIgb3V0IG9mIG1vZGFsIGFuZCBpbnRvIG91ciB0b3AgdGFiIHRyYXAgZWxlbWVudAogICAgICAgIC8vIEZpbmQgdGhlIGxhc3QgdGFiYWJsZSBlbGVtZW50IGluIHRoZSBtb2RhbCBjb250ZW50IGFuZCBmb2N1cyBpdAogICAgICAgIGlmIChhdHRlbXB0Rm9jdXModGFiYWJsZXNbdGFiYWJsZXMubGVuZ3RoIC0gMV0pKSB7CiAgICAgICAgICAvLyBGb2N1cyB3YXMgc3VjY2Vzc2Z1bAogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfSAvLyBPdGhlcndpc2UgZm9jdXMgdGhlIG1vZGFsIGNvbnRlbnQgY29udGFpbmVyCgoKICAgICAgYXR0ZW1wdEZvY3VzKGNvbnRlbnQsIHsKICAgICAgICBwcmV2ZW50U2Nyb2xsOiB0cnVlCiAgICAgIH0pOwogICAgfSwKICAgIC8vIFR1cm4gb24vb2ZmIGZvY3VzaW4gbGlzdGVuZXIKICAgIHNldEVuZm9yY2VGb2N1czogZnVuY3Rpb24gc2V0RW5mb3JjZUZvY3VzKG9uKSB7CiAgICAgIHRoaXMubGlzdGVuRG9jdW1lbnQob24sICdmb2N1c2luJywgdGhpcy5mb2N1c0hhbmRsZXIpOwogICAgfSwKICAgIC8vIFJlc2l6ZSBsaXN0ZW5lcgogICAgc2V0UmVzaXplRXZlbnQ6IGZ1bmN0aW9uIHNldFJlc2l6ZUV2ZW50KG9uKSB7CiAgICAgIHRoaXMubGlzdGVuV2luZG93KG9uLCAncmVzaXplJywgdGhpcy5jaGVja01vZGFsT3ZlcmZsb3cpOwogICAgICB0aGlzLmxpc3RlbldpbmRvdyhvbiwgJ29yaWVudGF0aW9uY2hhbmdlJywgdGhpcy5jaGVja01vZGFsT3ZlcmZsb3cpOwogICAgfSwKICAgIC8vIFJvb3QgbGlzdGVuZXIgaGFuZGxlcnMKICAgIHNob3dIYW5kbGVyOiBmdW5jdGlvbiBzaG93SGFuZGxlcihpZCwgdHJpZ2dlckVsKSB7CiAgICAgIGlmIChpZCA9PT0gdGhpcy5tb2RhbElkKSB7CiAgICAgICAgdGhpcy4kX3JldHVybkZvY3VzID0gdHJpZ2dlckVsIHx8IHRoaXMuZ2V0QWN0aXZlRWxlbWVudCgpOwogICAgICAgIHRoaXMuc2hvdygpOwogICAgICB9CiAgICB9LAogICAgaGlkZUhhbmRsZXI6IGZ1bmN0aW9uIGhpZGVIYW5kbGVyKGlkKSB7CiAgICAgIGlmIChpZCA9PT0gdGhpcy5tb2RhbElkKSB7CiAgICAgICAgdGhpcy5oaWRlKCdldmVudCcpOwogICAgICB9CiAgICB9LAogICAgdG9nZ2xlSGFuZGxlcjogZnVuY3Rpb24gdG9nZ2xlSGFuZGxlcihpZCwgdHJpZ2dlckVsKSB7CiAgICAgIGlmIChpZCA9PT0gdGhpcy5tb2RhbElkKSB7CiAgICAgICAgdGhpcy50b2dnbGUodHJpZ2dlckVsKTsKICAgICAgfQogICAgfSwKICAgIG1vZGFsTGlzdGVuZXI6IGZ1bmN0aW9uIG1vZGFsTGlzdGVuZXIoYnZFdmVudCkgewogICAgICAvLyBJZiBhbm90aGVyIG1vZGFsIG9wZW5zLCBjbG9zZSB0aGlzIG9uZSBpZiBzdGFja2luZyBub3QgcGVybWl0dGVkCiAgICAgIGlmICh0aGlzLm5vU3RhY2tpbmcgJiYgYnZFdmVudC52dWVUYXJnZXQgIT09IHRoaXMpIHsKICAgICAgICB0aGlzLmhpZGUoKTsKICAgICAgfQogICAgfSwKICAgIC8vIEZvY3VzIGNvbnRyb2wgaGFuZGxlcnMKICAgIGZvY3VzRmlyc3Q6IGZ1bmN0aW9uIGZvY3VzRmlyc3QoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOyAvLyBEb24ndCB0cnkgYW5kIGZvY3VzIGlmIHdlIGFyZSBTU1IKCgogICAgICBpZiAoSVNfQlJPV1NFUikgewogICAgICAgIHJlcXVlc3RBRihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgbW9kYWwgPSBfdGhpczYuJHJlZnMubW9kYWw7CiAgICAgICAgICB2YXIgY29udGVudCA9IF90aGlzNi4kcmVmcy5jb250ZW50OwoKICAgICAgICAgIHZhciBhY3RpdmVFbGVtZW50ID0gX3RoaXM2LmdldEFjdGl2ZUVsZW1lbnQoKTsgLy8gSWYgdGhlIG1vZGFsIGNvbnRhaW5zIHRoZSBhY3RpdmVFbGVtZW50LCB3ZSBkb24ndCBkbyBhbnl0aGluZwoKCiAgICAgICAgICBpZiAobW9kYWwgJiYgY29udGVudCAmJiAhKGFjdGl2ZUVsZW1lbnQgJiYgY29udGFpbnMoY29udGVudCwgYWN0aXZlRWxlbWVudCkpKSB7CiAgICAgICAgICAgIHZhciBvayA9IF90aGlzNi4kcmVmc1snb2stYnV0dG9uJ107CiAgICAgICAgICAgIHZhciBjYW5jZWwgPSBfdGhpczYuJHJlZnNbJ2NhbmNlbC1idXR0b24nXTsKICAgICAgICAgICAgdmFyIGNsb3NlID0gX3RoaXM2LiRyZWZzWydjbG9zZS1idXR0b24nXTsgLy8gRm9jdXMgdGhlIGFwcHJvcHJpYXRlIGJ1dHRvbiBvciBtb2RhbCBjb250ZW50IHdyYXBwZXIKCiAgICAgICAgICAgIHZhciBhdXRvRm9jdXMgPSBfdGhpczYuYXV0b0ZvY3VzQnV0dG9uOwogICAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwoKICAgICAgICAgICAgdmFyIGVsID0gYXV0b0ZvY3VzID09PSBCVVRUT05fT0sgJiYgb2sgPyBvay4kZWwgfHwgb2sgOiBhdXRvRm9jdXMgPT09IEJVVFRPTl9DQU5DRUwgJiYgY2FuY2VsID8gY2FuY2VsLiRlbCB8fCBjYW5jZWwgOiBhdXRvRm9jdXMgPT09IEJVVFRPTl9DTE9TRSAmJiBjbG9zZSA/IGNsb3NlLiRlbCB8fCBjbG9zZSA6IGNvbnRlbnQ7IC8vIEZvY3VzIHRoZSBlbGVtZW50CgogICAgICAgICAgICBhdHRlbXB0Rm9jdXMoZWwpOwoKICAgICAgICAgICAgaWYgKGVsID09PSBjb250ZW50KSB7CiAgICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHRvcCBvZiBtb2RhbCBpcyBzaG93aW5nIChpZiBsb25nZXIgdGhhbiB0aGUgdmlld3BvcnQpCiAgICAgICAgICAgICAgX3RoaXM2LiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBtb2RhbC5zY3JvbGxUb3AgPSAwOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICByZXR1cm5Gb2N1c1RvOiBmdW5jdGlvbiByZXR1cm5Gb2N1c1RvKCkgewogICAgICAvLyBQcmVmZXIgYHJldHVybkZvY3VzYCBwcm9wIG92ZXIgZXZlbnQgc3BlY2lmaWVkCiAgICAgIC8vIGByZXR1cm5fZm9jdXNgIHZhbHVlCiAgICAgIHZhciBlbCA9IHRoaXMucmV0dXJuRm9jdXMgfHwgdGhpcy4kX3JldHVybkZvY3VzIHx8IG51bGw7CiAgICAgIHRoaXMuJF9yZXR1cm5Gb2N1cyA9IG51bGw7CiAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAvLyBJcyBlbCBhIHN0cmluZyBDU1Mgc2VsZWN0b3I/CiAgICAgICAgZWwgPSBpc1N0cmluZyhlbCkgPyBzZWxlY3QoZWwpIDogZWw7CgogICAgICAgIGlmIChlbCkgewogICAgICAgICAgLy8gUG9zc2libHkgY291bGQgYmUgYSBjb21wb25lbnQgcmVmZXJlbmNlCiAgICAgICAgICBlbCA9IGVsLiRlbCB8fCBlbDsKICAgICAgICAgIGF0dGVtcHRGb2N1cyhlbCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBjaGVja01vZGFsT3ZlcmZsb3c6IGZ1bmN0aW9uIGNoZWNrTW9kYWxPdmVyZmxvdygpIHsKICAgICAgaWYgKHRoaXMuaXNWaXNpYmxlKSB7CiAgICAgICAgdmFyIG1vZGFsID0gdGhpcy4kcmVmcy5tb2RhbDsKICAgICAgICB0aGlzLmlzTW9kYWxPdmVyZmxvd2luZyA9IG1vZGFsLnNjcm9sbEhlaWdodCA+IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQ7CiAgICAgIH0KICAgIH0sCiAgICBtYWtlTW9kYWw6IGZ1bmN0aW9uIG1ha2VNb2RhbChoKSB7CiAgICAgIC8vIE1vZGFsIGhlYWRlcgogICAgICB2YXIgJGhlYWRlciA9IGgoKTsKCiAgICAgIGlmICghdGhpcy5oaWRlSGVhZGVyKSB7CiAgICAgICAgLy8gVE9ETzogUmVuYW1lIHNsb3QgdG8gYGhlYWRlcmAgYW5kIGRlcHJlY2F0ZSBgbW9kYWwtaGVhZGVyYAogICAgICAgIHZhciAkbW9kYWxIZWFkZXIgPSB0aGlzLm5vcm1hbGl6ZVNsb3QoU0xPVF9OQU1FX01PREFMX0hFQURFUiwgdGhpcy5zbG90U2NvcGUpOwoKICAgICAgICBpZiAoISRtb2RhbEhlYWRlcikgewogICAgICAgICAgdmFyICRjbG9zZUJ1dHRvbiA9IGgoKTsKCiAgICAgICAgICBpZiAoIXRoaXMuaGlkZUhlYWRlckNsb3NlKSB7CiAgICAgICAgICAgICRjbG9zZUJ1dHRvbiA9IGgoQkJ1dHRvbkNsb3NlLCB7CiAgICAgICAgICAgICAgcHJvcHM6IHsKICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHRoaXMuaGVhZGVyQ2xvc2VDb250ZW50LAogICAgICAgICAgICAgICAgZGlzYWJsZWQ6IHRoaXMuaXNUcmFuc2l0aW9uaW5nLAogICAgICAgICAgICAgICAgYXJpYUxhYmVsOiB0aGlzLmhlYWRlckNsb3NlTGFiZWwsCiAgICAgICAgICAgICAgICB0ZXh0VmFyaWFudDogdGhpcy5oZWFkZXJDbG9zZVZhcmlhbnQgfHwgdGhpcy5oZWFkZXJUZXh0VmFyaWFudAogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgb246IHsKICAgICAgICAgICAgICAgIGNsaWNrOiB0aGlzLm9uQ2xvc2UKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIHJlZjogJ2Nsb3NlLWJ1dHRvbicKICAgICAgICAgICAgfSwgLy8gVE9ETzogUmVuYW1lIHNsb3QgdG8gYGhlYWRlci1jbG9zZWAgYW5kIGRlcHJlY2F0ZSBgbW9kYWwtaGVhZGVyLWNsb3NlYAogICAgICAgICAgICBbdGhpcy5ub3JtYWxpemVTbG90KFNMT1RfTkFNRV9NT0RBTF9IRUFERVJfQ0xPU0UpXSk7CiAgICAgICAgICB9CgogICAgICAgICAgJG1vZGFsSGVhZGVyID0gW2godGhpcy50aXRsZVRhZywgewogICAgICAgICAgICBzdGF0aWNDbGFzczogJ21vZGFsLXRpdGxlJywKICAgICAgICAgICAgImNsYXNzIjogdGhpcy50aXRsZUNsYXNzZXMsCiAgICAgICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAgICAgaWQ6IHRoaXMubW9kYWxUaXRsZUlkCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIFRPRE86IFJlbmFtZSBzbG90IHRvIGB0aXRsZWAgYW5kIGRlcHJlY2F0ZSBgbW9kYWwtdGl0bGVgCiAgICAgICAgICAgIGRvbVByb3BzOiB0aGlzLmhhc05vcm1hbGl6ZWRTbG90KFNMT1RfTkFNRV9NT0RBTF9USVRMRSkgPyB7fSA6IGh0bWxPclRleHQodGhpcy50aXRsZUh0bWwsIHRoaXMudGl0bGUpCiAgICAgICAgICB9LCAvLyBUT0RPOiBSZW5hbWUgc2xvdCB0byBgdGl0bGVgIGFuZCBkZXByZWNhdGUgYG1vZGFsLXRpdGxlYAogICAgICAgICAgdGhpcy5ub3JtYWxpemVTbG90KFNMT1RfTkFNRV9NT0RBTF9USVRMRSwgdGhpcy5zbG90U2NvcGUpKSwgJGNsb3NlQnV0dG9uXTsKICAgICAgICB9CgogICAgICAgICRoZWFkZXIgPSBoKCdoZWFkZXInLCB7CiAgICAgICAgICBzdGF0aWNDbGFzczogJ21vZGFsLWhlYWRlcicsCiAgICAgICAgICAiY2xhc3MiOiB0aGlzLmhlYWRlckNsYXNzZXMsCiAgICAgICAgICBhdHRyczogewogICAgICAgICAgICBpZDogdGhpcy5tb2RhbEhlYWRlcklkCiAgICAgICAgICB9LAogICAgICAgICAgcmVmOiAnaGVhZGVyJwogICAgICAgIH0sIFskbW9kYWxIZWFkZXJdKTsKICAgICAgfSAvLyBNb2RhbCBib2R5CgoKICAgICAgdmFyICRib2R5ID0gaCgnZGl2JywgewogICAgICAgIHN0YXRpY0NsYXNzOiAnbW9kYWwtYm9keScsCiAgICAgICAgImNsYXNzIjogdGhpcy5ib2R5Q2xhc3NlcywKICAgICAgICBhdHRyczogewogICAgICAgICAgaWQ6IHRoaXMubW9kYWxCb2R5SWQKICAgICAgICB9LAogICAgICAgIHJlZjogJ2JvZHknCiAgICAgIH0sIHRoaXMubm9ybWFsaXplU2xvdChTTE9UX05BTUVfREVGQVVMVCwgdGhpcy5zbG90U2NvcGUpKTsgLy8gTW9kYWwgZm9vdGVyCgogICAgICB2YXIgJGZvb3RlciA9IGgoKTsKCiAgICAgIGlmICghdGhpcy5oaWRlRm9vdGVyKSB7CiAgICAgICAgLy8gVE9ETzogUmVuYW1lIHNsb3QgdG8gYGZvb3RlcmAgYW5kIGRlcHJlY2F0ZSBgbW9kYWwtZm9vdGVyYAogICAgICAgIHZhciAkbW9kYWxGb290ZXIgPSB0aGlzLm5vcm1hbGl6ZVNsb3QoU0xPVF9OQU1FX01PREFMX0ZPT1RFUiwgdGhpcy5zbG90U2NvcGUpOwoKICAgICAgICBpZiAoISRtb2RhbEZvb3RlcikgewogICAgICAgICAgdmFyICRjYW5jZWxCdXR0b24gPSBoKCk7CgogICAgICAgICAgaWYgKCF0aGlzLm9rT25seSkgewogICAgICAgICAgICAkY2FuY2VsQnV0dG9uID0gaChCQnV0dG9uLCB7CiAgICAgICAgICAgICAgcHJvcHM6IHsKICAgICAgICAgICAgICAgIHZhcmlhbnQ6IHRoaXMuY2FuY2VsVmFyaWFudCwKICAgICAgICAgICAgICAgIHNpemU6IHRoaXMuYnV0dG9uU2l6ZSwKICAgICAgICAgICAgICAgIGRpc2FibGVkOiB0aGlzLmNhbmNlbERpc2FibGVkIHx8IHRoaXMuYnVzeSB8fCB0aGlzLmlzVHJhbnNpdGlvbmluZwogICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgLy8gVE9ETzogUmVuYW1lIHNsb3QgdG8gYGNhbmNlbC1idXR0b25gIGFuZCBkZXByZWNhdGUgYG1vZGFsLWNhbmNlbGAKICAgICAgICAgICAgICBkb21Qcm9wczogdGhpcy5oYXNOb3JtYWxpemVkU2xvdChTTE9UX05BTUVfTU9EQUxfQ0FOQ0VMKSA/IHt9IDogaHRtbE9yVGV4dCh0aGlzLmNhbmNlbFRpdGxlSHRtbCwgdGhpcy5jYW5jZWxUaXRsZSksCiAgICAgICAgICAgICAgb246IHsKICAgICAgICAgICAgICAgIGNsaWNrOiB0aGlzLm9uQ2FuY2VsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICByZWY6ICdjYW5jZWwtYnV0dG9uJwogICAgICAgICAgICB9LCAvLyBUT0RPOiBSZW5hbWUgc2xvdCB0byBgY2FuY2VsLWJ1dHRvbmAgYW5kIGRlcHJlY2F0ZSBgbW9kYWwtY2FuY2VsYAogICAgICAgICAgICB0aGlzLm5vcm1hbGl6ZVNsb3QoU0xPVF9OQU1FX01PREFMX0NBTkNFTCkpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciAkb2tCdXR0b24gPSBoKEJCdXR0b24sIHsKICAgICAgICAgICAgcHJvcHM6IHsKICAgICAgICAgICAgICB2YXJpYW50OiB0aGlzLm9rVmFyaWFudCwKICAgICAgICAgICAgICBzaXplOiB0aGlzLmJ1dHRvblNpemUsCiAgICAgICAgICAgICAgZGlzYWJsZWQ6IHRoaXMub2tEaXNhYmxlZCB8fCB0aGlzLmJ1c3kgfHwgdGhpcy5pc1RyYW5zaXRpb25pbmcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLy8gVE9ETzogUmVuYW1lIHNsb3QgdG8gYG9rLWJ1dHRvbmAgYW5kIGRlcHJlY2F0ZSBgbW9kYWwtb2tgCiAgICAgICAgICAgIGRvbVByb3BzOiB0aGlzLmhhc05vcm1hbGl6ZWRTbG90KFNMT1RfTkFNRV9NT0RBTF9PSykgPyB7fSA6IGh0bWxPclRleHQodGhpcy5va1RpdGxlSHRtbCwgdGhpcy5va1RpdGxlKSwKICAgICAgICAgICAgb246IHsKICAgICAgICAgICAgICBjbGljazogdGhpcy5vbk9rCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHJlZjogJ29rLWJ1dHRvbicKICAgICAgICAgIH0sIC8vIFRPRE86IFJlbmFtZSBzbG90IHRvIGBvay1idXR0b25gIGFuZCBkZXByZWNhdGUgYG1vZGFsLW9rYAogICAgICAgICAgdGhpcy5ub3JtYWxpemVTbG90KFNMT1RfTkFNRV9NT0RBTF9PSykpOwogICAgICAgICAgJG1vZGFsRm9vdGVyID0gWyRjYW5jZWxCdXR0b24sICRva0J1dHRvbl07CiAgICAgICAgfQoKICAgICAgICAkZm9vdGVyID0gaCgnZm9vdGVyJywgewogICAgICAgICAgc3RhdGljQ2xhc3M6ICdtb2RhbC1mb290ZXInLAogICAgICAgICAgImNsYXNzIjogdGhpcy5mb290ZXJDbGFzc2VzLAogICAgICAgICAgYXR0cnM6IHsKICAgICAgICAgICAgaWQ6IHRoaXMubW9kYWxGb290ZXJJZAogICAgICAgICAgfSwKICAgICAgICAgIHJlZjogJ2Zvb3RlcicKICAgICAgICB9LCBbJG1vZGFsRm9vdGVyXSk7CiAgICAgIH0gLy8gQXNzZW1ibGUgbW9kYWwgY29udGVudAoKCiAgICAgIHZhciAkbW9kYWxDb250ZW50ID0gaCgnZGl2JywgewogICAgICAgIHN0YXRpY0NsYXNzOiAnbW9kYWwtY29udGVudCcsCiAgICAgICAgImNsYXNzIjogdGhpcy5jb250ZW50Q2xhc3MsCiAgICAgICAgYXR0cnM6IHsKICAgICAgICAgIGlkOiB0aGlzLm1vZGFsQ29udGVudElkLAogICAgICAgICAgdGFiaW5kZXg6ICctMScKICAgICAgICB9LAogICAgICAgIHJlZjogJ2NvbnRlbnQnCiAgICAgIH0sIFskaGVhZGVyLCAkYm9keSwgJGZvb3Rlcl0pOyAvLyBUYWIgdHJhcHMgdG8gcHJldmVudCBwYWdlIGZyb20gc2Nyb2xsaW5nIHRvIG5leHQgZWxlbWVudCBpbgogICAgICAvLyB0YWIgaW5kZXggZHVyaW5nIGVuZm9yY2UtZm9jdXMgdGFiIGN5Y2xlCgogICAgICB2YXIgJHRhYlRyYXBUb3AgPSBoKCk7CiAgICAgIHZhciAkdGFiVHJhcEJvdHRvbSA9IGgoKTsKCiAgICAgIGlmICh0aGlzLmlzVmlzaWJsZSAmJiAhdGhpcy5ub0VuZm9yY2VGb2N1cykgewogICAgICAgICR0YWJUcmFwVG9wID0gaCgnc3BhbicsIHsKICAgICAgICAgIGF0dHJzOiB7CiAgICAgICAgICAgIHRhYmluZGV4OiAnMCcKICAgICAgICAgIH0sCiAgICAgICAgICByZWY6ICd0b3AtdHJhcCcKICAgICAgICB9KTsKICAgICAgICAkdGFiVHJhcEJvdHRvbSA9IGgoJ3NwYW4nLCB7CiAgICAgICAgICBhdHRyczogewogICAgICAgICAgICB0YWJpbmRleDogJzAnCiAgICAgICAgICB9LAogICAgICAgICAgcmVmOiAnYm90dG9tLXRyYXAnCiAgICAgICAgfSk7CiAgICAgIH0gLy8gTW9kYWwgZGlhbG9nIHdyYXBwZXIKCgogICAgICB2YXIgJG1vZGFsRGlhbG9nID0gaCgnZGl2JywgewogICAgICAgIHN0YXRpY0NsYXNzOiAnbW9kYWwtZGlhbG9nJywKICAgICAgICAiY2xhc3MiOiB0aGlzLmRpYWxvZ0NsYXNzZXMsCiAgICAgICAgb246IHsKICAgICAgICAgIG1vdXNlZG93bjogdGhpcy5vbkRpYWxvZ01vdXNlZG93bgogICAgICAgIH0sCiAgICAgICAgcmVmOiAnZGlhbG9nJwogICAgICB9LCBbJHRhYlRyYXBUb3AsICRtb2RhbENvbnRlbnQsICR0YWJUcmFwQm90dG9tXSk7IC8vIE1vZGFsCgogICAgICB2YXIgJG1vZGFsID0gaCgnZGl2JywgewogICAgICAgIHN0YXRpY0NsYXNzOiAnbW9kYWwnLAogICAgICAgICJjbGFzcyI6IHRoaXMubW9kYWxDbGFzc2VzLAogICAgICAgIHN0eWxlOiB0aGlzLm1vZGFsU3R5bGVzLAogICAgICAgIGF0dHJzOiB0aGlzLmNvbXB1dGVkTW9kYWxBdHRycywKICAgICAgICBvbjogewogICAgICAgICAga2V5ZG93bjogdGhpcy5vbkVzYywKICAgICAgICAgIGNsaWNrOiB0aGlzLm9uQ2xpY2tPdXQKICAgICAgICB9LAogICAgICAgIGRpcmVjdGl2ZXM6IFt7CiAgICAgICAgICBuYW1lOiAnc2hvdycsCiAgICAgICAgICB2YWx1ZTogdGhpcy5pc1Zpc2libGUKICAgICAgICB9XSwKICAgICAgICByZWY6ICdtb2RhbCcKICAgICAgfSwgWyRtb2RhbERpYWxvZ10pOyAvLyBXcmFwIG1vZGFsIGluIHRyYW5zaXRpb24KICAgICAgLy8gU2FkbHksIHdlIGNhbid0IHVzZSBgQlZUcmFuc2l0aW9uYCBoZXJlIGR1ZSB0byB0aGUgZGlmZmVyZW5jZXMgaW4KICAgICAgLy8gdHJhbnNpdGlvbiBkdXJhdGlvbnMgZm9yIGAubW9kYWxgIGFuZCBgLm1vZGFsLWRpYWxvZ2AKICAgICAgLy8gQXQgbGVhc3QgdW50aWwgaHR0cHM6Ly9naXRodWIuY29tL3Z1ZWpzL3Z1ZS9pc3N1ZXMvOTk4NiBpcyByZXNvbHZlZAoKICAgICAgJG1vZGFsID0gaCgndHJhbnNpdGlvbicsIHsKICAgICAgICBwcm9wczogewogICAgICAgICAgZW50ZXJDbGFzczogJycsCiAgICAgICAgICBlbnRlclRvQ2xhc3M6ICcnLAogICAgICAgICAgZW50ZXJBY3RpdmVDbGFzczogJycsCiAgICAgICAgICBsZWF2ZUNsYXNzOiAnJywKICAgICAgICAgIGxlYXZlQWN0aXZlQ2xhc3M6ICcnLAogICAgICAgICAgbGVhdmVUb0NsYXNzOiAnJwogICAgICAgIH0sCiAgICAgICAgb246IHsKICAgICAgICAgIGJlZm9yZUVudGVyOiB0aGlzLm9uQmVmb3JlRW50ZXIsCiAgICAgICAgICBlbnRlcjogdGhpcy5vbkVudGVyLAogICAgICAgICAgYWZ0ZXJFbnRlcjogdGhpcy5vbkFmdGVyRW50ZXIsCiAgICAgICAgICBiZWZvcmVMZWF2ZTogdGhpcy5vbkJlZm9yZUxlYXZlLAogICAgICAgICAgbGVhdmU6IHRoaXMub25MZWF2ZSwKICAgICAgICAgIGFmdGVyTGVhdmU6IHRoaXMub25BZnRlckxlYXZlCiAgICAgICAgfQogICAgICB9LCBbJG1vZGFsXSk7IC8vIE1vZGFsIGJhY2tkcm9wCgogICAgICB2YXIgJGJhY2tkcm9wID0gaCgpOwoKICAgICAgaWYgKCF0aGlzLmhpZGVCYWNrZHJvcCAmJiB0aGlzLmlzVmlzaWJsZSkgewogICAgICAgICRiYWNrZHJvcCA9IGgoJ2RpdicsIHsKICAgICAgICAgIHN0YXRpY0NsYXNzOiAnbW9kYWwtYmFja2Ryb3AnLAogICAgICAgICAgYXR0cnM6IHsKICAgICAgICAgICAgaWQ6IHRoaXMubW9kYWxCYWNrZHJvcElkCiAgICAgICAgICB9CiAgICAgICAgfSwgLy8gVE9ETzogUmVuYW1lIHNsb3QgdG8gYGJhY2tkcm9wYCBhbmQgZGVwcmVjYXRlIGBtb2RhbC1iYWNrZHJvcGAKICAgICAgICB0aGlzLm5vcm1hbGl6ZVNsb3QoU0xPVF9OQU1FX01PREFMX0JBQ0tEUk9QKSk7CiAgICAgIH0KCiAgICAgICRiYWNrZHJvcCA9IGgoQlZUcmFuc2l0aW9uLCB7CiAgICAgICAgcHJvcHM6IHsKICAgICAgICAgIG5vRmFkZTogdGhpcy5ub0ZhZGUKICAgICAgICB9CiAgICAgIH0sIFskYmFja2Ryb3BdKTsgLy8gQXNzZW1ibGUgbW9kYWwgYW5kIGJhY2tkcm9wIGluIGFuIG91dGVyIDxkaXY+CgogICAgICByZXR1cm4gaCgnZGl2JywgewogICAgICAgIHN0eWxlOiB0aGlzLm1vZGFsT3V0ZXJTdHlsZSwKICAgICAgICBhdHRyczogdGhpcy5jb21wdXRlZEF0dHJzLAogICAgICAgIGtleTogIm1vZGFsLW91dGVyLSIuY29uY2F0KHRoaXNbQ09NUE9ORU5UX1VJRF9LRVldKQogICAgICB9LCBbJG1vZGFsLCAkYmFja2Ryb3BdKTsKICAgIH0KICB9LAogIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKGgpIHsKICAgIGlmICh0aGlzWyJzdGF0aWMiXSkgewogICAgICByZXR1cm4gdGhpcy5sYXp5ICYmIHRoaXMuaXNIaWRkZW4gPyBoKCkgOiB0aGlzLm1ha2VNb2RhbChoKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB0aGlzLmlzSGlkZGVuID8gaCgpIDogaChCVlRyYW5zcG9ydGVyLCBbdGhpcy5tYWtlTW9kYWwoaCldKTsKICAgIH0KICB9Cn0pOw=="},null]}